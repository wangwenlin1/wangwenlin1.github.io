<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>动态模版 | 一名GO+PHP工程师</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b3aba94c.css" as="style"><link rel="preload" href="/blog/assets/js/app.5a38db11.js" as="script"><link rel="preload" href="/blog/assets/js/3.21e2e031.js" as="script"><link rel="preload" href="/blog/assets/js/150.7360f0a5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc3bb372.js"><link rel="prefetch" href="/blog/assets/js/100.35b5db36.js"><link rel="prefetch" href="/blog/assets/js/101.a70b97e2.js"><link rel="prefetch" href="/blog/assets/js/102.30af4d63.js"><link rel="prefetch" href="/blog/assets/js/103.c5c5130e.js"><link rel="prefetch" href="/blog/assets/js/104.161b590d.js"><link rel="prefetch" href="/blog/assets/js/105.eaae1ece.js"><link rel="prefetch" href="/blog/assets/js/106.028ce766.js"><link rel="prefetch" href="/blog/assets/js/107.c9b230ac.js"><link rel="prefetch" href="/blog/assets/js/108.a5880443.js"><link rel="prefetch" href="/blog/assets/js/109.bab44539.js"><link rel="prefetch" href="/blog/assets/js/11.ef5dbacc.js"><link rel="prefetch" href="/blog/assets/js/110.7ba602f1.js"><link rel="prefetch" href="/blog/assets/js/111.2b0b0a78.js"><link rel="prefetch" href="/blog/assets/js/112.6b9220f5.js"><link rel="prefetch" href="/blog/assets/js/113.6a2724aa.js"><link rel="prefetch" href="/blog/assets/js/114.ac347ea2.js"><link rel="prefetch" href="/blog/assets/js/115.17c6c526.js"><link rel="prefetch" href="/blog/assets/js/116.1fd8cdf3.js"><link rel="prefetch" href="/blog/assets/js/117.193b54e8.js"><link rel="prefetch" href="/blog/assets/js/118.8a3e18a9.js"><link rel="prefetch" href="/blog/assets/js/119.2a5bb73a.js"><link rel="prefetch" href="/blog/assets/js/12.2003a6c5.js"><link rel="prefetch" href="/blog/assets/js/120.edb5435e.js"><link rel="prefetch" href="/blog/assets/js/121.6e61cfa4.js"><link rel="prefetch" href="/blog/assets/js/122.8ce24886.js"><link rel="prefetch" href="/blog/assets/js/123.beccf42c.js"><link rel="prefetch" href="/blog/assets/js/124.416ddc09.js"><link rel="prefetch" href="/blog/assets/js/125.7be39e4f.js"><link rel="prefetch" href="/blog/assets/js/126.49439b56.js"><link rel="prefetch" href="/blog/assets/js/127.7d06eb7f.js"><link rel="prefetch" href="/blog/assets/js/128.9b247099.js"><link rel="prefetch" href="/blog/assets/js/129.6503c09f.js"><link rel="prefetch" href="/blog/assets/js/13.93951a43.js"><link rel="prefetch" href="/blog/assets/js/130.3fa988b7.js"><link rel="prefetch" href="/blog/assets/js/131.f93ef260.js"><link rel="prefetch" href="/blog/assets/js/132.7dca0041.js"><link rel="prefetch" href="/blog/assets/js/133.286b95ad.js"><link rel="prefetch" href="/blog/assets/js/134.88627057.js"><link rel="prefetch" href="/blog/assets/js/135.a28b714b.js"><link rel="prefetch" href="/blog/assets/js/136.fba0a306.js"><link rel="prefetch" href="/blog/assets/js/137.5540419d.js"><link rel="prefetch" href="/blog/assets/js/138.82fb7775.js"><link rel="prefetch" href="/blog/assets/js/139.787b1320.js"><link rel="prefetch" href="/blog/assets/js/14.379e0027.js"><link rel="prefetch" href="/blog/assets/js/140.b68497e2.js"><link rel="prefetch" href="/blog/assets/js/141.cd76190b.js"><link rel="prefetch" href="/blog/assets/js/142.8e56d4f0.js"><link rel="prefetch" href="/blog/assets/js/143.23971a8d.js"><link rel="prefetch" href="/blog/assets/js/144.8c41b407.js"><link rel="prefetch" href="/blog/assets/js/145.95b58ec4.js"><link rel="prefetch" href="/blog/assets/js/146.18132cf9.js"><link rel="prefetch" href="/blog/assets/js/147.8275026a.js"><link rel="prefetch" href="/blog/assets/js/148.cc2257d6.js"><link rel="prefetch" href="/blog/assets/js/149.a98d647c.js"><link rel="prefetch" href="/blog/assets/js/15.5376294f.js"><link rel="prefetch" href="/blog/assets/js/151.0cf39bd7.js"><link rel="prefetch" href="/blog/assets/js/152.6f7d01ad.js"><link rel="prefetch" href="/blog/assets/js/153.f6075040.js"><link rel="prefetch" href="/blog/assets/js/154.12eeb9b2.js"><link rel="prefetch" href="/blog/assets/js/155.65f03a29.js"><link rel="prefetch" href="/blog/assets/js/156.d2f6d50d.js"><link rel="prefetch" href="/blog/assets/js/157.f4384a9b.js"><link rel="prefetch" href="/blog/assets/js/158.34747ec7.js"><link rel="prefetch" href="/blog/assets/js/159.410bff01.js"><link rel="prefetch" href="/blog/assets/js/16.abdf559d.js"><link rel="prefetch" href="/blog/assets/js/160.53124933.js"><link rel="prefetch" href="/blog/assets/js/161.0ab0763e.js"><link rel="prefetch" href="/blog/assets/js/162.39021ec7.js"><link rel="prefetch" href="/blog/assets/js/163.596b82cf.js"><link rel="prefetch" href="/blog/assets/js/164.cbd2db78.js"><link rel="prefetch" href="/blog/assets/js/165.6e6c3d3a.js"><link rel="prefetch" href="/blog/assets/js/166.5bcaa3dd.js"><link rel="prefetch" href="/blog/assets/js/167.b4296d08.js"><link rel="prefetch" href="/blog/assets/js/168.27dc81ce.js"><link rel="prefetch" href="/blog/assets/js/169.661c763c.js"><link rel="prefetch" href="/blog/assets/js/17.8b47c823.js"><link rel="prefetch" href="/blog/assets/js/170.e41001f5.js"><link rel="prefetch" href="/blog/assets/js/171.0724bbd4.js"><link rel="prefetch" href="/blog/assets/js/172.2d5b541f.js"><link rel="prefetch" href="/blog/assets/js/173.41d6e737.js"><link rel="prefetch" href="/blog/assets/js/174.bccb9fa6.js"><link rel="prefetch" href="/blog/assets/js/175.b1a13486.js"><link rel="prefetch" href="/blog/assets/js/176.6e26a58e.js"><link rel="prefetch" href="/blog/assets/js/177.67fa30a9.js"><link rel="prefetch" href="/blog/assets/js/178.7f4bf5e6.js"><link rel="prefetch" href="/blog/assets/js/18.6a619898.js"><link rel="prefetch" href="/blog/assets/js/19.ea80b1e1.js"><link rel="prefetch" href="/blog/assets/js/2.04feeb4a.js"><link rel="prefetch" href="/blog/assets/js/20.77762601.js"><link rel="prefetch" href="/blog/assets/js/21.656ab41e.js"><link rel="prefetch" href="/blog/assets/js/22.5922a16f.js"><link rel="prefetch" href="/blog/assets/js/23.41929ef9.js"><link rel="prefetch" href="/blog/assets/js/24.3b850e15.js"><link rel="prefetch" href="/blog/assets/js/25.aade9e50.js"><link rel="prefetch" href="/blog/assets/js/26.36c6a527.js"><link rel="prefetch" href="/blog/assets/js/27.907a8228.js"><link rel="prefetch" href="/blog/assets/js/28.cc2bee0d.js"><link rel="prefetch" href="/blog/assets/js/29.52c7bfa4.js"><link rel="prefetch" href="/blog/assets/js/30.f034dd77.js"><link rel="prefetch" href="/blog/assets/js/31.edcef4fa.js"><link rel="prefetch" href="/blog/assets/js/32.6735d3e7.js"><link rel="prefetch" href="/blog/assets/js/33.28f8dc69.js"><link rel="prefetch" href="/blog/assets/js/34.8a729d66.js"><link rel="prefetch" href="/blog/assets/js/35.920cdf75.js"><link rel="prefetch" href="/blog/assets/js/36.15f2a36b.js"><link rel="prefetch" href="/blog/assets/js/37.5b03bd21.js"><link rel="prefetch" href="/blog/assets/js/38.fed1555d.js"><link rel="prefetch" href="/blog/assets/js/39.68d965cd.js"><link rel="prefetch" href="/blog/assets/js/4.644e7959.js"><link rel="prefetch" href="/blog/assets/js/40.069924f4.js"><link rel="prefetch" href="/blog/assets/js/41.a44d976c.js"><link rel="prefetch" href="/blog/assets/js/42.47caadd3.js"><link rel="prefetch" href="/blog/assets/js/43.b1eb7b31.js"><link rel="prefetch" href="/blog/assets/js/44.96773f8a.js"><link rel="prefetch" href="/blog/assets/js/45.328fda2a.js"><link rel="prefetch" href="/blog/assets/js/46.24f71020.js"><link rel="prefetch" href="/blog/assets/js/47.96df34c4.js"><link rel="prefetch" href="/blog/assets/js/48.b0bfea08.js"><link rel="prefetch" href="/blog/assets/js/49.3dac2a21.js"><link rel="prefetch" href="/blog/assets/js/5.0760b076.js"><link rel="prefetch" href="/blog/assets/js/50.97f9d2b0.js"><link rel="prefetch" href="/blog/assets/js/51.29fb5c68.js"><link rel="prefetch" href="/blog/assets/js/52.d2042f8d.js"><link rel="prefetch" href="/blog/assets/js/53.02c82b26.js"><link rel="prefetch" href="/blog/assets/js/54.667f483f.js"><link rel="prefetch" href="/blog/assets/js/55.b6b1e0e7.js"><link rel="prefetch" href="/blog/assets/js/56.bd954c20.js"><link rel="prefetch" href="/blog/assets/js/57.45722d8c.js"><link rel="prefetch" href="/blog/assets/js/58.17cd106d.js"><link rel="prefetch" href="/blog/assets/js/59.51661424.js"><link rel="prefetch" href="/blog/assets/js/6.d309aec3.js"><link rel="prefetch" href="/blog/assets/js/60.18a9a452.js"><link rel="prefetch" href="/blog/assets/js/61.819ab903.js"><link rel="prefetch" href="/blog/assets/js/62.24bf6999.js"><link rel="prefetch" href="/blog/assets/js/63.2f87f55d.js"><link rel="prefetch" href="/blog/assets/js/64.68cd3b45.js"><link rel="prefetch" href="/blog/assets/js/65.7fe0d182.js"><link rel="prefetch" href="/blog/assets/js/66.948be4c4.js"><link rel="prefetch" href="/blog/assets/js/67.2522194c.js"><link rel="prefetch" href="/blog/assets/js/68.0a66e8af.js"><link rel="prefetch" href="/blog/assets/js/69.07a744c4.js"><link rel="prefetch" href="/blog/assets/js/7.073a2745.js"><link rel="prefetch" href="/blog/assets/js/70.c0e92ba6.js"><link rel="prefetch" href="/blog/assets/js/71.97a4d551.js"><link rel="prefetch" href="/blog/assets/js/72.78fc6941.js"><link rel="prefetch" href="/blog/assets/js/73.3e3efdc5.js"><link rel="prefetch" href="/blog/assets/js/74.cff95a30.js"><link rel="prefetch" href="/blog/assets/js/75.6c4af1f1.js"><link rel="prefetch" href="/blog/assets/js/76.96c205c1.js"><link rel="prefetch" href="/blog/assets/js/77.31c8dd27.js"><link rel="prefetch" href="/blog/assets/js/78.41729cec.js"><link rel="prefetch" href="/blog/assets/js/79.12735350.js"><link rel="prefetch" href="/blog/assets/js/8.5e05a8d5.js"><link rel="prefetch" href="/blog/assets/js/80.e5005d72.js"><link rel="prefetch" href="/blog/assets/js/81.04f50a1e.js"><link rel="prefetch" href="/blog/assets/js/82.db879ca5.js"><link rel="prefetch" href="/blog/assets/js/83.e89b8863.js"><link rel="prefetch" href="/blog/assets/js/84.07410b58.js"><link rel="prefetch" href="/blog/assets/js/85.d46c8682.js"><link rel="prefetch" href="/blog/assets/js/86.3869d59e.js"><link rel="prefetch" href="/blog/assets/js/87.e7860b15.js"><link rel="prefetch" href="/blog/assets/js/88.2b183553.js"><link rel="prefetch" href="/blog/assets/js/89.36e67a82.js"><link rel="prefetch" href="/blog/assets/js/9.8a6a0670.js"><link rel="prefetch" href="/blog/assets/js/90.acd5023c.js"><link rel="prefetch" href="/blog/assets/js/91.d1662d38.js"><link rel="prefetch" href="/blog/assets/js/92.4093acc4.js"><link rel="prefetch" href="/blog/assets/js/93.f09d7ba1.js"><link rel="prefetch" href="/blog/assets/js/94.1e2891fe.js"><link rel="prefetch" href="/blog/assets/js/95.83afadb6.js"><link rel="prefetch" href="/blog/assets/js/96.85084d66.js"><link rel="prefetch" href="/blog/assets/js/97.16a7a60a.js"><link rel="prefetch" href="/blog/assets/js/98.a84fee2e.js"><link rel="prefetch" href="/blog/assets/js/99.f9452cba.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b3aba94c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一名GO+PHP工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Elasticsearch/1Elasticsearch概述" class="sidebar-heading clickable"><span>Elasticsearch</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Elasticsearch/1Elasticsearch概述.html" class="sidebar-link">概述</a></li><li><a href="/blog/数据库/Elasticsearch/2Elasticsearch入门.html" class="sidebar-link">入门</a></li><li><a href="/blog/数据库/Elasticsearch/3EFK集群环境.html" class="sidebar-link">集群环境</a></li><li><a href="/blog/数据库/Elasticsearch/4Elasticsearch进阶.html" class="sidebar-link">进阶</a></li><li><a href="/blog/数据库/Elasticsearch/6Elasticsearch优化.html" class="sidebar-link">优化</a></li><li><a href="/blog/数据库/Elasticsearch/7Elasticsearch面试题.html" class="sidebar-link">面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Elasticsearch/深入学习/搜索-1.查询DSL" class="sidebar-heading clickable open"><span>深入学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Elasticsearch/深入学习/搜索-1.查询DSL.html" class="sidebar-link">查询DSL</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-1.动态字段映射.html" class="sidebar-link">动态字段映射</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html" class="active sidebar-link">动态模版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#验证动态模板" class="sidebar-link">验证动态模板</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#映射动态模板中的运行时字段" class="sidebar-link">映射动态模板中的运行时字段</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#match-和-unmatch" class="sidebar-link">match 和 unmatch</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#模板变量" class="sidebar-link">模板变量</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#动态模板示例" class="sidebar-link">动态模板示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#结构化搜索" class="sidebar-link">结构化搜索</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#text-只有字符串的映射" class="sidebar-link">text-只有字符串的映射</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#禁用标准" class="sidebar-link">禁用标准</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#时间序列" class="sidebar-link">时间序列</a></li></ul></li></ul></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-3.元字段.html" class="sidebar-link">元字段</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-4.映射参数.html" class="sidebar-link">映射参数</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/索引.html" class="sidebar-link">索引管理</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/聚合-Pipeline 聚合分析.html" class="sidebar-link">Pipeline 聚合分析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="动态模版"><a href="#动态模版" class="header-anchor">#</a> 动态模版</h1> <p>动态模板允许您更好地控制 Elasticsearch 如何将数据映射到默认的动态字段映射规则之外。您可以通过将动态参数设置为 true 或运行时来启用动态映射。然后你可以使用动态模板定义自定义的映射，这些映射可以根据匹配条件应用到动态添加的字段:</p> <ul><li>操作 Elasticsearch 检测到的数据类型</li> <li>使用模式来匹配字段名</li> <li>按照完整的虚线路径进行操作</li></ul> <p>使用映射规范中的{name}和{dynamic_type}模板变量作为占位符。</p> <p>动态字段映射只有在字段包含具体值时才会添加ー而不是null或空数组。如果在动态模板中使用 null_value 选项，则只有在第一个具有字段具体值的文档被索引之后，才会应用它。</p> <p>动态模板被指定为命名对象的数组:</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;dynamic_templates&quot;: [
    {
      &quot;my_template_name&quot;: { 
        ...  match conditions ... 
        &quot;mapping&quot;: { ... } 
      }
    },
    ...
  ]
</code></pre></div><ul><li>模板名称可以是任何字符串值。</li> <li>匹配条件可以包括: match_mapping_type、 match、 match_pattern、 unmatch、 path_match、 path_unmatch。</li> <li>匹配字段应该使用的映射。</li></ul> <h2 id="验证动态模板"><a href="#验证动态模板" class="header-anchor">#</a> 验证动态模板</h2> <p>如果提供的映射包含无效映射代码片段，则返回验证错误。在索引时应用动态模板时进行验证，在大多数情况下，在更新动态模板时进行验证。在某些情况下，提供无效的映射代码片段可能会导致动态模板的更新或验证失败:</p> <ul><li>如果没有 但该模板对于至少一个预定义的映射类型有效，则映射代码片段被认为是有效的。但是，如果与模板匹配的字段被索引为不同的类型，则在索引时返回验证错误。例如，将动态模板配置为 被认为作为字符串类型有效，但是如果匹配动态模板的字段被索引为 long，则在索引时返回验证错误。建议配置 或配置所需的 JSON 类型 在地图片段中</li> <li>如果 占位符用于映射代码片段，在更新动态模板时跳过验证。这是因为当时字段名称未知。相反，在索引时应用模板时进行验证</li></ul> <p>模板是按顺序处理的ーー第一个匹配的模板胜出。当通过 put 映射 API 放置新的动态模板时，所有现有的模板都会被覆盖。这允许在最初添加动态模板之后对其进行重新排序或删除。</p> <h2 id="映射动态模板中的运行时字段"><a href="#映射动态模板中的运行时字段" class="header-anchor">#</a> 映射动态模板中的运行时字段</h2> <p>如果希望 Elasticsearch 动态地将特定类型的新字段映射为运行时字段，请在索引映射中设置&quot;dynamic&quot;:&quot;runtime&quot;。这些字段没有索引，并且在查询时从 _source 加载。</p> <p>或者，您可以使用默认的动态映射规则，然后创建动态模板来将特定字段映射为运行时字段。在索引映射中设置&quot;dynamic&quot;: &quot;true&quot;，然后创建一个动态模板，将特定类型的新字段映射为运行时字段。</p> <p>假设您有每个字段都以 ip_开头的数据。根据动态映射规则，Elasticsearch 将任何通过数值检测的字符串映射为 float 或 long。但是，您可以创建一个动态模板，将新字符串映射为类型为 ip 的运行时字段。</p> <p>下面的请求定义了一个名为 strings_as_ip 的动态模板。当 Elasticsearch 检测到与 ip * 模式匹配的新字符串字段时，它会将这些字段映射为类型为 ip 的运行时字段。因为 ip 字段不是动态映射的，所以您可以使用这个模板&quot;dynamic&quot;: &quot;true&quot; 或 &quot;dynamic&quot;: &quot;runtime&quot;。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_ip&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;: &quot;ip*&quot;,
          &quot;runtime&quot;: {
            &quot;type&quot;: &quot;ip&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><p>有关如何使用动态模板将字符串字段映射为索引字段或运行时字段，请参见此示例。</p> <p>match_mapping_type 是 JSON 解析器检测到的数据类型。因为 JSON 不区分 long 和整数，也不区分 double 和 float，所以它总是选择更广泛的数据类型，比如 long 表示整数，double 表示浮点数。</p> <p>自动检测以下数据类型:</p> <table><thead><tr><th style="text-align:left;"><strong>JSON data type</strong></th> <th style="text-align:left;"><strong><code>&quot;dynamic&quot;:&quot;true&quot;</code></strong></th> <th style="text-align:left;"><strong><code>&quot;dynamic&quot;:&quot;runtime&quot;</code></strong></th></tr></thead> <tbody><tr><td style="text-align:left;"><code>null</code></td> <td style="text-align:left;">No field added</td> <td style="text-align:left;">No field added</td></tr> <tr><td style="text-align:left;"><code>true</code> or <code>false</code></td> <td style="text-align:left;"><code>boolean</code></td> <td style="text-align:left;"><code>boolean</code></td></tr> <tr><td style="text-align:left;"><code>double</code></td> <td style="text-align:left;"><code>float</code></td> <td style="text-align:left;"><code>double</code></td></tr> <tr><td style="text-align:left;"><code>integer</code></td> <td style="text-align:left;"><code>long</code></td> <td style="text-align:left;"><code>long</code></td></tr> <tr><td style="text-align:left;"><code>object</code>^1^</td> <td style="text-align:left;"><code>object</code></td> <td style="text-align:left;"><code>object</code></td></tr> <tr><td style="text-align:left;"><code>array</code></td> <td style="text-align:left;">Depends on the first non-<code>null</code> value in the array</td> <td style="text-align:left;">Depends on the first non-<code>null</code> value in the array</td></tr> <tr><td style="text-align:left;">通过日期检测的string</td> <td style="text-align:left;"><code>date</code></td> <td style="text-align:left;"><code>date</code></td></tr> <tr><td style="text-align:left;">通过数字检测的string</td> <td style="text-align:left;"><code>float</code> or <code>long</code></td> <td style="text-align:left;"><code>double</code> or <code>long</code></td></tr> <tr><td style="text-align:left;">不能通过日期检测或数字检测的字符串</td> <td style="text-align:left;">带有. keyword 子字段的 text</td> <td style="text-align:left;"><code>keyword</code></td></tr></tbody></table> <p>使用通配符(*)匹配所有数据类型。</p> <p>例如，如果我们想将所有整数字段映射为整数字段而不是长字段，并将所有字符串字段映射为文本和关键字，我们可以使用以下模板:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;integers&quot;: {
          &quot;match_mapping_type&quot;: &quot;long&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;integer&quot;
          }
        }
      },
      {
        &quot;strings&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;fields&quot;: {
              &quot;raw&quot;: {
                &quot;type&quot;:  &quot;keyword&quot;,
                &quot;ignore_above&quot;: 256
              }
            }
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;my_integer&quot;: 5, 
  &quot;my_string&quot;: &quot;Some string&quot; 
}
</code></pre></div><ul><li>my_integer 字段被映射为整数。</li> <li>my_string 字段被映射为一个文本，带有一个关键字 multi 字段。</li></ul> <h2 id="match-和-unmatch"><a href="#match-和-unmatch" class="header-anchor">#</a> match 和 unmatch</h2> <p>match 参数使用一个模式来匹配字段名，而 unmatch 使用一个模式来排除匹配的字段。</p> <p>match_pattern 参数调整 match 参数的行为，以支持字段名称上的完整 Java 正则表达式匹配，而不是简单的通配符。例如:</p> <div class="language- extra-class"><pre class="language-text"><code>  &quot;match_pattern&quot;: &quot;regex&quot;,
  &quot;match&quot;: &quot;^profit_\d+$&quot;
</code></pre></div><p>下面的示例匹配所有名称以 long_ (除了以 _text 结尾的字段)开头的字符串字段，并将它们映射为长字段:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;longs_as_strings&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;:   &quot;long_*&quot;,
          &quot;unmatch&quot;: &quot;*_text&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;long&quot;
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;long_num&quot;: &quot;5&quot;, 
  &quot;long_text&quot;: &quot;foo&quot; 
}
</code></pre></div><ul><li>long_num 字段被映射为 long。</li> <li>long_text 字段使用默认的字符串映射。</li></ul> <p>path_match 和 path_unmatch 参数的工作方式与 match 和 unmatch 相同，但是操作的是字段的完整虚线路径，而不仅仅是最终名称，例如某个_object。*.某个地方。</p> <p>此示例将 name 对象中任何字段的值复制到顶级 full_name 字段，但中间字段除外:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;full_name&quot;: {
          &quot;path_match&quot;:   &quot;name.*&quot;,
          &quot;path_unmatch&quot;: &quot;*.middle&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;:       &quot;text&quot;,
            &quot;copy_to&quot;:    &quot;full_name&quot;
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;name&quot;: {
    &quot;first&quot;:  &quot;John&quot;,
    &quot;middle&quot;: &quot;Winston&quot;,
    &quot;last&quot;:   &quot;Lennon&quot;
  }
}
</code></pre></div><p>请注意，path_match 和 path_unmatch 参数除了与叶字段相匹配外，还与对象路径相匹配。例如，为下面的文档建立索引会导致一个错误，因为 path_match 设置也匹配对象字段 name.title，它不能被映射为文本:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/_doc/2
{
  &quot;name&quot;: {
    &quot;first&quot;:  &quot;Paul&quot;,
    &quot;last&quot;:   &quot;McCartney&quot;,
    &quot;title&quot;: {
      &quot;value&quot;: &quot;Sir&quot;,
      &quot;category&quot;: &quot;order of chivalry&quot;
    }
  }
}
</code></pre></div><h2 id="模板变量"><a href="#模板变量" class="header-anchor">#</a> 模板变量</h2> <p>在与字段名称和检测到的动态类型的映射中替换{ name }和{ dynamic_type }占位符。下面的示例设置所有字符串字段，使用与字段同名的分析器，并禁用所有非字符串字段的 doc_value:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;named_analyzers&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;: &quot;*&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;analyzer&quot;: &quot;{name}&quot;
          }
        }
      },
      {
        &quot;no_doc_values&quot;: {
          &quot;match_mapping_type&quot;:&quot;*&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;{dynamic_type}&quot;,
            &quot;doc_values&quot;: false
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;english&quot;: &quot;Some English text&quot;, 
  &quot;count&quot;:   5 
}
</code></pre></div><ul><li>英文字段被映射为带有英文分析器的字符串字段。</li> <li>count 字段映射为禁用 doc_值的长字段。</li></ul> <h2 id="动态模板示例"><a href="#动态模板示例" class="header-anchor">#</a> 动态模板示例</h2> <p>下面是一些可能有用的动态模板的例子:</p> <h3 id="结构化搜索"><a href="#结构化搜索" class="header-anchor">#</a> 结构化搜索</h3> <p>当您设置&quot; dynamic&quot;: &quot;true&quot;时，Elasticsearch 将把字符串字段映射为带有关键字子字段的文本字段。如果你只是索引结构化内容或者对全文搜索不感兴趣，你可以使 Elasticsearch 只把你的字段作为关键字字段。但是，必须搜索与索引搜索这些字段完全相同的值。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;keyword&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><h3 id="text-只有字符串的映射"><a href="#text-只有字符串的映射" class="header-anchor">#</a> text-只有字符串的映射</h3> <p>与前面的例子相反，如果你只关心字符串字段的全文搜索，而不打算运行聚合、排序或精确搜索，你可以告诉 Elasticsearch 将字符串映射为文本:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_text&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><p>或者，您可以创建一个动态模板，将字符串字段映射为映射的运行时部分中的关键字字段。当 Elasticsearch 检测到类型为 string 的新字段时，这些字段将被创建为类型为 keyword 的运行时字段。</p> <p>虽然字符串字段不会被索引，但是它们的值存储在_source 中，可以用于搜索请求、聚合、筛选和排序。</p> <p>例如，下面的请求创建一个动态模板，将字符串字段映射为 keyword 类型的运行时字段。虽然运行时定义是空白的，新的字符串字段将被映射为基于 Elasticsearch 用于向映射添加字段类型的动态映射规则的关键字运行时字段。任何没有通过日期检测或数字检测的字符串都会自动映射为关键字:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;runtime&quot;: {}
        }
      }
    ]
  }
}
</code></pre></div><p>你索引一个简单的文档:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/_doc/1
{
  &quot;english&quot;: &quot;Some English text&quot;,
  &quot;count&quot;:   5
}
</code></pre></div><p>当你查看映射时，你会看到英文字段是一个类型为 keyword 的运行时字段:</p> <div class="language- extra-class"><pre class="language-text"><code>GET  my-index-000001/_mapping
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>{
  &quot;my-index-000001&quot; : {
    &quot;mappings&quot; : {
      &quot;dynamic_templates&quot; : [
        {
          &quot;strings_as_keywords&quot; : {
            &quot;match_mapping_type&quot; : &quot;string&quot;,
            &quot;runtime&quot; : { }
          }
        }
      ],
      &quot;runtime&quot; : {
        &quot;english&quot; : {
          &quot;type&quot; : &quot;keyword&quot;
        }
      },
      &quot;properties&quot; : {
        &quot;count&quot; : {
          &quot;type&quot; : &quot;long&quot;
        }
      }
    }
  }
}
</code></pre></div><h3 id="禁用标准"><a href="#禁用标准" class="header-anchor">#</a> 禁用标准</h3> <p>常模为指数时间评分因子。如果您不关心计分，例如，如果您从来不按分数对文档进行排序，那么您可以禁用索引中这些计分因子的存储并节省一些空间。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;norms&quot;: false,
            &quot;fields&quot;: {
              &quot;keyword&quot;: {
                &quot;type&quot;: &quot;keyword&quot;,
                &quot;ignore_above&quot;: 256
              }
            }
          }
        }
      }
    ]
  }
}
</code></pre></div><p>子关键字字段在此模板中显示为与动态映射的默认规则一致。当然，如果您不需要它们，因为您不需要对这个字段执行精确的搜索或聚合，那么您可以按照前面部分的描述移除它。</p> <h3 id="时间序列"><a href="#时间序列" class="header-anchor">#</a> 时间序列</h3> <p>在使用 Elasticsearch 进行时间序列分析时，通常会有许多数字字段，您经常会对这些字段进行聚合，但是不会对其进行过滤。在这种情况下，你可以禁用这些字段的索引，以节省磁盘空间，也许还可以获得一些索引速度:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;unindexed_longs&quot;: {
          &quot;match_mapping_type&quot;: &quot;long&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;long&quot;,
            &quot;index&quot;: false
          }
        }
      },
      {
        &quot;unindexed_doubles&quot;: {
          &quot;match_mapping_type&quot;: &quot;double&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;float&quot;, 
            &quot;index&quot;: false
          }
        }
      }
    ]
  }
}
</code></pre></div><ul><li>与默认的动态映射规则一样，双精度打印被映射为浮点数，这通常足够精确，但需要一半的磁盘空间。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/21/2021, 1:25:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/数据库/Elasticsearch/深入学习/映射-1.动态字段映射.html" class="prev">
        动态字段映射
      </a></span> <span class="next"><a href="/blog/数据库/Elasticsearch/深入学习/映射-3.元字段.html">
        元字段
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.5a38db11.js" defer></script><script src="/blog/assets/js/3.21e2e031.js" defer></script><script src="/blog/assets/js/150.7360f0a5.js" defer></script>
  </body>
</html>
