<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>动态模版 | 一名GO+PHP工程师</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.e16ad0a6.css" as="style"><link rel="preload" href="/blog/assets/js/app.b472f60d.js" as="script"><link rel="preload" href="/blog/assets/js/3.21e2e031.js" as="script"><link rel="preload" href="/blog/assets/js/150.6514db42.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.414eb148.js"><link rel="prefetch" href="/blog/assets/js/100.35b5db36.js"><link rel="prefetch" href="/blog/assets/js/101.a70b97e2.js"><link rel="prefetch" href="/blog/assets/js/102.30af4d63.js"><link rel="prefetch" href="/blog/assets/js/103.a362f49e.js"><link rel="prefetch" href="/blog/assets/js/104.a207d395.js"><link rel="prefetch" href="/blog/assets/js/105.eaae1ece.js"><link rel="prefetch" href="/blog/assets/js/106.9b961ba0.js"><link rel="prefetch" href="/blog/assets/js/107.df9ba599.js"><link rel="prefetch" href="/blog/assets/js/108.a5880443.js"><link rel="prefetch" href="/blog/assets/js/109.538edbe1.js"><link rel="prefetch" href="/blog/assets/js/11.ef37454d.js"><link rel="prefetch" href="/blog/assets/js/110.91c6d5de.js"><link rel="prefetch" href="/blog/assets/js/111.2211f82c.js"><link rel="prefetch" href="/blog/assets/js/112.6b9220f5.js"><link rel="prefetch" href="/blog/assets/js/113.9b314292.js"><link rel="prefetch" href="/blog/assets/js/114.b05dc902.js"><link rel="prefetch" href="/blog/assets/js/115.6a21a21a.js"><link rel="prefetch" href="/blog/assets/js/116.f4969b27.js"><link rel="prefetch" href="/blog/assets/js/117.c6601199.js"><link rel="prefetch" href="/blog/assets/js/118.a54057c2.js"><link rel="prefetch" href="/blog/assets/js/119.f0742def.js"><link rel="prefetch" href="/blog/assets/js/12.2003a6c5.js"><link rel="prefetch" href="/blog/assets/js/120.a3d456af.js"><link rel="prefetch" href="/blog/assets/js/121.afee83c8.js"><link rel="prefetch" href="/blog/assets/js/122.ffc358e4.js"><link rel="prefetch" href="/blog/assets/js/123.b7cb0f42.js"><link rel="prefetch" href="/blog/assets/js/124.ca59f8f6.js"><link rel="prefetch" href="/blog/assets/js/125.7be39e4f.js"><link rel="prefetch" href="/blog/assets/js/126.8b8a9b2d.js"><link rel="prefetch" href="/blog/assets/js/127.3d53f72f.js"><link rel="prefetch" href="/blog/assets/js/128.ebd5e805.js"><link rel="prefetch" href="/blog/assets/js/129.c960281b.js"><link rel="prefetch" href="/blog/assets/js/13.4a08f423.js"><link rel="prefetch" href="/blog/assets/js/130.9ee2fb72.js"><link rel="prefetch" href="/blog/assets/js/131.1155be64.js"><link rel="prefetch" href="/blog/assets/js/132.866a7ce5.js"><link rel="prefetch" href="/blog/assets/js/133.ea694d5c.js"><link rel="prefetch" href="/blog/assets/js/134.d585508a.js"><link rel="prefetch" href="/blog/assets/js/135.1132a9d3.js"><link rel="prefetch" href="/blog/assets/js/136.fe9832ed.js"><link rel="prefetch" href="/blog/assets/js/137.574e5c35.js"><link rel="prefetch" href="/blog/assets/js/138.87124965.js"><link rel="prefetch" href="/blog/assets/js/139.e394567e.js"><link rel="prefetch" href="/blog/assets/js/14.0ee281ea.js"><link rel="prefetch" href="/blog/assets/js/140.c2741475.js"><link rel="prefetch" href="/blog/assets/js/141.cd76190b.js"><link rel="prefetch" href="/blog/assets/js/142.bc1d599e.js"><link rel="prefetch" href="/blog/assets/js/143.e16816e7.js"><link rel="prefetch" href="/blog/assets/js/144.c91db5db.js"><link rel="prefetch" href="/blog/assets/js/145.95b58ec4.js"><link rel="prefetch" href="/blog/assets/js/146.c5ff12f5.js"><link rel="prefetch" href="/blog/assets/js/147.ef38cae8.js"><link rel="prefetch" href="/blog/assets/js/148.b0a6ba25.js"><link rel="prefetch" href="/blog/assets/js/149.f0a6fc97.js"><link rel="prefetch" href="/blog/assets/js/15.de9db6ca.js"><link rel="prefetch" href="/blog/assets/js/151.dcf981a0.js"><link rel="prefetch" href="/blog/assets/js/152.6a733b47.js"><link rel="prefetch" href="/blog/assets/js/153.1a5b425b.js"><link rel="prefetch" href="/blog/assets/js/154.59a5cdd0.js"><link rel="prefetch" href="/blog/assets/js/155.1ecb4821.js"><link rel="prefetch" href="/blog/assets/js/156.e514afd4.js"><link rel="prefetch" href="/blog/assets/js/157.c01cdccb.js"><link rel="prefetch" href="/blog/assets/js/158.71dda3a8.js"><link rel="prefetch" href="/blog/assets/js/159.33fa138a.js"><link rel="prefetch" href="/blog/assets/js/16.03e830ed.js"><link rel="prefetch" href="/blog/assets/js/160.41012461.js"><link rel="prefetch" href="/blog/assets/js/161.93be8033.js"><link rel="prefetch" href="/blog/assets/js/162.d1adee89.js"><link rel="prefetch" href="/blog/assets/js/163.35e7409e.js"><link rel="prefetch" href="/blog/assets/js/164.b5140f57.js"><link rel="prefetch" href="/blog/assets/js/165.f7cbff8f.js"><link rel="prefetch" href="/blog/assets/js/166.e5008cd5.js"><link rel="prefetch" href="/blog/assets/js/167.56eb9dbd.js"><link rel="prefetch" href="/blog/assets/js/168.27dc81ce.js"><link rel="prefetch" href="/blog/assets/js/169.2b833606.js"><link rel="prefetch" href="/blog/assets/js/17.997071ba.js"><link rel="prefetch" href="/blog/assets/js/170.4469c187.js"><link rel="prefetch" href="/blog/assets/js/171.ff778380.js"><link rel="prefetch" href="/blog/assets/js/172.ed65c8c1.js"><link rel="prefetch" href="/blog/assets/js/173.41d6e737.js"><link rel="prefetch" href="/blog/assets/js/174.bccb9fa6.js"><link rel="prefetch" href="/blog/assets/js/175.deb32fb8.js"><link rel="prefetch" href="/blog/assets/js/176.2380b0cf.js"><link rel="prefetch" href="/blog/assets/js/177.67fa30a9.js"><link rel="prefetch" href="/blog/assets/js/178.7f4bf5e6.js"><link rel="prefetch" href="/blog/assets/js/18.c000b794.js"><link rel="prefetch" href="/blog/assets/js/19.d0523809.js"><link rel="prefetch" href="/blog/assets/js/2.43a980f2.js"><link rel="prefetch" href="/blog/assets/js/20.e9165d7c.js"><link rel="prefetch" href="/blog/assets/js/21.e0c3e1c3.js"><link rel="prefetch" href="/blog/assets/js/22.87f8326f.js"><link rel="prefetch" href="/blog/assets/js/23.6f53a063.js"><link rel="prefetch" href="/blog/assets/js/24.1249f968.js"><link rel="prefetch" href="/blog/assets/js/25.a976dac8.js"><link rel="prefetch" href="/blog/assets/js/26.54c900ef.js"><link rel="prefetch" href="/blog/assets/js/27.7621a087.js"><link rel="prefetch" href="/blog/assets/js/28.ec739e1d.js"><link rel="prefetch" href="/blog/assets/js/29.76ea8050.js"><link rel="prefetch" href="/blog/assets/js/30.6417632a.js"><link rel="prefetch" href="/blog/assets/js/31.3f4523df.js"><link rel="prefetch" href="/blog/assets/js/32.666cd74a.js"><link rel="prefetch" href="/blog/assets/js/33.a689a6fc.js"><link rel="prefetch" href="/blog/assets/js/34.6cc2c586.js"><link rel="prefetch" href="/blog/assets/js/35.86d13f87.js"><link rel="prefetch" href="/blog/assets/js/36.20e014f1.js"><link rel="prefetch" href="/blog/assets/js/37.8b69cd99.js"><link rel="prefetch" href="/blog/assets/js/38.f1cc6c40.js"><link rel="prefetch" href="/blog/assets/js/39.5664b0d3.js"><link rel="prefetch" href="/blog/assets/js/4.60804666.js"><link rel="prefetch" href="/blog/assets/js/40.2943fb88.js"><link rel="prefetch" href="/blog/assets/js/41.6201f829.js"><link rel="prefetch" href="/blog/assets/js/42.2e1b7a5b.js"><link rel="prefetch" href="/blog/assets/js/43.9c1b7439.js"><link rel="prefetch" href="/blog/assets/js/44.68f63f99.js"><link rel="prefetch" href="/blog/assets/js/45.328fda2a.js"><link rel="prefetch" href="/blog/assets/js/46.0bd04509.js"><link rel="prefetch" href="/blog/assets/js/47.b8cfe094.js"><link rel="prefetch" href="/blog/assets/js/48.59825d73.js"><link rel="prefetch" href="/blog/assets/js/49.cffe09bd.js"><link rel="prefetch" href="/blog/assets/js/5.548a74f6.js"><link rel="prefetch" href="/blog/assets/js/50.97f9d2b0.js"><link rel="prefetch" href="/blog/assets/js/51.564cf3e9.js"><link rel="prefetch" href="/blog/assets/js/52.d2042f8d.js"><link rel="prefetch" href="/blog/assets/js/53.a70a48c8.js"><link rel="prefetch" href="/blog/assets/js/54.9a93718c.js"><link rel="prefetch" href="/blog/assets/js/55.bd9a7852.js"><link rel="prefetch" href="/blog/assets/js/56.c2bf89f1.js"><link rel="prefetch" href="/blog/assets/js/57.a8ad91e4.js"><link rel="prefetch" href="/blog/assets/js/58.51d02d31.js"><link rel="prefetch" href="/blog/assets/js/59.bd516f75.js"><link rel="prefetch" href="/blog/assets/js/6.2a5a1504.js"><link rel="prefetch" href="/blog/assets/js/60.b70f4aa5.js"><link rel="prefetch" href="/blog/assets/js/61.0ce9673a.js"><link rel="prefetch" href="/blog/assets/js/62.24bf6999.js"><link rel="prefetch" href="/blog/assets/js/63.6b1d0cdc.js"><link rel="prefetch" href="/blog/assets/js/64.0a87210f.js"><link rel="prefetch" href="/blog/assets/js/65.255d0e52.js"><link rel="prefetch" href="/blog/assets/js/66.34889547.js"><link rel="prefetch" href="/blog/assets/js/67.d5b053a1.js"><link rel="prefetch" href="/blog/assets/js/68.24775a0c.js"><link rel="prefetch" href="/blog/assets/js/69.6b6ae34e.js"><link rel="prefetch" href="/blog/assets/js/7.e088d63d.js"><link rel="prefetch" href="/blog/assets/js/70.49ff7561.js"><link rel="prefetch" href="/blog/assets/js/71.97a4d551.js"><link rel="prefetch" href="/blog/assets/js/72.49706859.js"><link rel="prefetch" href="/blog/assets/js/73.d2f96422.js"><link rel="prefetch" href="/blog/assets/js/74.3c8755ec.js"><link rel="prefetch" href="/blog/assets/js/75.5800081d.js"><link rel="prefetch" href="/blog/assets/js/76.a63525d6.js"><link rel="prefetch" href="/blog/assets/js/77.da3a7d1d.js"><link rel="prefetch" href="/blog/assets/js/78.d8480922.js"><link rel="prefetch" href="/blog/assets/js/79.64a09aa3.js"><link rel="prefetch" href="/blog/assets/js/8.f3bc1f32.js"><link rel="prefetch" href="/blog/assets/js/80.932971cd.js"><link rel="prefetch" href="/blog/assets/js/81.04f50a1e.js"><link rel="prefetch" href="/blog/assets/js/82.db879ca5.js"><link rel="prefetch" href="/blog/assets/js/83.e89b8863.js"><link rel="prefetch" href="/blog/assets/js/84.07410b58.js"><link rel="prefetch" href="/blog/assets/js/85.d46c8682.js"><link rel="prefetch" href="/blog/assets/js/86.3869d59e.js"><link rel="prefetch" href="/blog/assets/js/87.e7860b15.js"><link rel="prefetch" href="/blog/assets/js/88.09fc332a.js"><link rel="prefetch" href="/blog/assets/js/89.8b302469.js"><link rel="prefetch" href="/blog/assets/js/9.da864c6e.js"><link rel="prefetch" href="/blog/assets/js/90.fab1b0e1.js"><link rel="prefetch" href="/blog/assets/js/91.d1662d38.js"><link rel="prefetch" href="/blog/assets/js/92.4093acc4.js"><link rel="prefetch" href="/blog/assets/js/93.d4c601c1.js"><link rel="prefetch" href="/blog/assets/js/94.1e2891fe.js"><link rel="prefetch" href="/blog/assets/js/95.758d874c.js"><link rel="prefetch" href="/blog/assets/js/96.85084d66.js"><link rel="prefetch" href="/blog/assets/js/97.16a7a60a.js"><link rel="prefetch" href="/blog/assets/js/98.a84fee2e.js"><link rel="prefetch" href="/blog/assets/js/99.f9452cba.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e16ad0a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一名GO+PHP工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Elasticsearch/1Elasticsearch概述" class="sidebar-heading clickable"><span>Elasticsearch</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Elasticsearch/1Elasticsearch概述.html" class="sidebar-link">概述</a></li><li><a href="/blog/数据库/Elasticsearch/2Elasticsearch入门.html" class="sidebar-link">入门</a></li><li><a href="/blog/数据库/Elasticsearch/3EFK集群环境.html" class="sidebar-link">集群环境</a></li><li><a href="/blog/数据库/Elasticsearch/4Elasticsearch进阶.html" class="sidebar-link">进阶</a></li><li><a href="/blog/数据库/Elasticsearch/6Elasticsearch优化.html" class="sidebar-link">优化</a></li><li><a href="/blog/数据库/Elasticsearch/7Elasticsearch面试题.html" class="sidebar-link">面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Elasticsearch/深入学习/搜索-1.查询DSL" class="sidebar-heading clickable open"><span>深入学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Elasticsearch/深入学习/搜索-1.查询DSL.html" class="sidebar-link">查询DSL</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-1.动态字段映射.html" class="sidebar-link">动态字段映射</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html" class="active sidebar-link">动态模版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#验证动态模板" class="sidebar-link">验证动态模板</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#映射动态模板中的运行时字段" class="sidebar-link">映射动态模板中的运行时字段</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#match-和-unmatch" class="sidebar-link">match 和 unmatch</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#模板变量" class="sidebar-link">模板变量</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#动态模板示例" class="sidebar-link">动态模板示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#结构化搜索" class="sidebar-link">结构化搜索</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#text-只有字符串的映射" class="sidebar-link">text-只有字符串的映射</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#禁用标准" class="sidebar-link">禁用标准</a></li><li class="sidebar-sub-header"><a href="/blog/数据库/Elasticsearch/深入学习/映射-2.动态模版.html#时间序列" class="sidebar-link">时间序列</a></li></ul></li></ul></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-3.元字段.html" class="sidebar-link">元字段</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/映射-4.映射参数.html" class="sidebar-link">映射参数</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/索引.html" class="sidebar-link">索引管理</a></li><li><a href="/blog/数据库/Elasticsearch/深入学习/聚合-Pipeline 聚合分析.html" class="sidebar-link">Pipeline 聚合分析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="动态模版"><a href="#动态模版" class="header-anchor">#</a> 动态模版</h1> <p>动态模板允许您更好地控制 Elasticsearch 如何将数据映射到默认的动态字段映射规则之外。您可以通过将动态参数设置为 true 或运行时来启用动态映射。然后你可以使用动态模板定义自定义的映射，这些映射可以根据匹配条件应用到动态添加的字段:</p> <ul><li>操作 Elasticsearch 检测到的数据类型</li> <li>使用模式来匹配字段名</li> <li>按照完整的虚线路径进行操作</li></ul> <p>使用映射规范中的{name}和{dynamic_type}模板变量作为占位符。</p> <p>动态字段映射只有在字段包含具体值时才会添加ー而不是null或空数组。如果在动态模板中使用 null_value 选项，则只有在第一个具有字段具体值的文档被索引之后，才会应用它。</p> <p>动态模板被指定为命名对象的数组:</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;dynamic_templates&quot;: [
    {
      &quot;my_template_name&quot;: { 
        ...  match conditions ... 
        &quot;mapping&quot;: { ... } 
      }
    },
    ...
  ]
</code></pre></div><ul><li>模板名称可以是任何字符串值。</li> <li>匹配条件可以包括: match_mapping_type、 match、 match_pattern、 unmatch、 path_match、 path_unmatch。</li> <li>匹配字段应该使用的映射。</li></ul> <h2 id="验证动态模板"><a href="#验证动态模板" class="header-anchor">#</a> 验证动态模板</h2> <p>如果提供的映射包含无效映射代码片段，则返回验证错误。在索引时应用动态模板时进行验证，在大多数情况下，在更新动态模板时进行验证。在某些情况下，提供无效的映射代码片段可能会导致动态模板的更新或验证失败:</p> <ul><li>如果没有 但该模板对于至少一个预定义的映射类型有效，则映射代码片段被认为是有效的。但是，如果与模板匹配的字段被索引为不同的类型，则在索引时返回验证错误。例如，将动态模板配置为 被认为作为字符串类型有效，但是如果匹配动态模板的字段被索引为 long，则在索引时返回验证错误。建议配置 或配置所需的 JSON 类型 在地图片段中</li> <li>如果 占位符用于映射代码片段，在更新动态模板时跳过验证。这是因为当时字段名称未知。相反，在索引时应用模板时进行验证</li></ul> <p>模板是按顺序处理的ーー第一个匹配的模板胜出。当通过 put 映射 API 放置新的动态模板时，所有现有的模板都会被覆盖。这允许在最初添加动态模板之后对其进行重新排序或删除。</p> <h2 id="映射动态模板中的运行时字段"><a href="#映射动态模板中的运行时字段" class="header-anchor">#</a> 映射动态模板中的运行时字段</h2> <p>如果希望 Elasticsearch 动态地将特定类型的新字段映射为运行时字段，请在索引映射中设置&quot;dynamic&quot;:&quot;runtime&quot;。这些字段没有索引，并且在查询时从 _source 加载。</p> <p>或者，您可以使用默认的动态映射规则，然后创建动态模板来将特定字段映射为运行时字段。在索引映射中设置&quot;dynamic&quot;: &quot;true&quot;，然后创建一个动态模板，将特定类型的新字段映射为运行时字段。</p> <p>假设您有每个字段都以 ip_开头的数据。根据动态映射规则，Elasticsearch 将任何通过数值检测的字符串映射为 float 或 long。但是，您可以创建一个动态模板，将新字符串映射为类型为 ip 的运行时字段。</p> <p>下面的请求定义了一个名为 strings_as_ip 的动态模板。当 Elasticsearch 检测到与 ip * 模式匹配的新字符串字段时，它会将这些字段映射为类型为 ip 的运行时字段。因为 ip 字段不是动态映射的，所以您可以使用这个模板&quot;dynamic&quot;: &quot;true&quot; 或 &quot;dynamic&quot;: &quot;runtime&quot;。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_ip&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;: &quot;ip*&quot;,
          &quot;runtime&quot;: {
            &quot;type&quot;: &quot;ip&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><p>有关如何使用动态模板将字符串字段映射为索引字段或运行时字段，请参见此示例。</p> <p>match_mapping_type 是 JSON 解析器检测到的数据类型。因为 JSON 不区分 long 和整数，也不区分 double 和 float，所以它总是选择更广泛的数据类型，比如 long 表示整数，double 表示浮点数。</p> <p>自动检测以下数据类型:</p> <table><thead><tr><th style="text-align:left;"><strong>JSON data type</strong></th> <th style="text-align:left;"><strong><code>&quot;dynamic&quot;:&quot;true&quot;</code></strong></th> <th style="text-align:left;"><strong><code>&quot;dynamic&quot;:&quot;runtime&quot;</code></strong></th></tr></thead> <tbody><tr><td style="text-align:left;"><code>null</code></td> <td style="text-align:left;">No field added</td> <td style="text-align:left;">No field added</td></tr> <tr><td style="text-align:left;"><code>true</code> or <code>false</code></td> <td style="text-align:left;"><code>boolean</code></td> <td style="text-align:left;"><code>boolean</code></td></tr> <tr><td style="text-align:left;"><code>double</code></td> <td style="text-align:left;"><code>float</code></td> <td style="text-align:left;"><code>double</code></td></tr> <tr><td style="text-align:left;"><code>integer</code></td> <td style="text-align:left;"><code>long</code></td> <td style="text-align:left;"><code>long</code></td></tr> <tr><td style="text-align:left;"><code>object</code>^1^</td> <td style="text-align:left;"><code>object</code></td> <td style="text-align:left;"><code>object</code></td></tr> <tr><td style="text-align:left;"><code>array</code></td> <td style="text-align:left;">Depends on the first non-<code>null</code> value in the array</td> <td style="text-align:left;">Depends on the first non-<code>null</code> value in the array</td></tr> <tr><td style="text-align:left;">通过日期检测的string</td> <td style="text-align:left;"><code>date</code></td> <td style="text-align:left;"><code>date</code></td></tr> <tr><td style="text-align:left;">通过数字检测的string</td> <td style="text-align:left;"><code>float</code> or <code>long</code></td> <td style="text-align:left;"><code>double</code> or <code>long</code></td></tr> <tr><td style="text-align:left;">不能通过日期检测或数字检测的字符串</td> <td style="text-align:left;">带有. keyword 子字段的 text</td> <td style="text-align:left;"><code>keyword</code></td></tr></tbody></table> <p>使用通配符(*)匹配所有数据类型。</p> <p>例如，如果我们想将所有整数字段映射为整数字段而不是长字段，并将所有字符串字段映射为文本和关键字，我们可以使用以下模板:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;integers&quot;: {
          &quot;match_mapping_type&quot;: &quot;long&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;integer&quot;
          }
        }
      },
      {
        &quot;strings&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;fields&quot;: {
              &quot;raw&quot;: {
                &quot;type&quot;:  &quot;keyword&quot;,
                &quot;ignore_above&quot;: 256
              }
            }
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;my_integer&quot;: 5, 
  &quot;my_string&quot;: &quot;Some string&quot; 
}
</code></pre></div><ul><li>my_integer 字段被映射为整数。</li> <li>my_string 字段被映射为一个文本，带有一个关键字 multi 字段。</li></ul> <h2 id="match-和-unmatch"><a href="#match-和-unmatch" class="header-anchor">#</a> match 和 unmatch</h2> <p>match 参数使用一个模式来匹配字段名，而 unmatch 使用一个模式来排除匹配的字段。</p> <p>match_pattern 参数调整 match 参数的行为，以支持字段名称上的完整 Java 正则表达式匹配，而不是简单的通配符。例如:</p> <div class="language- extra-class"><pre class="language-text"><code>  &quot;match_pattern&quot;: &quot;regex&quot;,
  &quot;match&quot;: &quot;^profit_\d+$&quot;
</code></pre></div><p>下面的示例匹配所有名称以 long_ (除了以 _text 结尾的字段)开头的字符串字段，并将它们映射为长字段:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;longs_as_strings&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;:   &quot;long_*&quot;,
          &quot;unmatch&quot;: &quot;*_text&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;long&quot;
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;long_num&quot;: &quot;5&quot;, 
  &quot;long_text&quot;: &quot;foo&quot; 
}
</code></pre></div><ul><li>long_num 字段被映射为 long。</li> <li>long_text 字段使用默认的字符串映射。</li></ul> <p>path_match 和 path_unmatch 参数的工作方式与 match 和 unmatch 相同，但是操作的是字段的完整虚线路径，而不仅仅是最终名称，例如某个_object。*.某个地方。</p> <p>此示例将 name 对象中任何字段的值复制到顶级 full_name 字段，但中间字段除外:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;full_name&quot;: {
          &quot;path_match&quot;:   &quot;name.*&quot;,
          &quot;path_unmatch&quot;: &quot;*.middle&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;:       &quot;text&quot;,
            &quot;copy_to&quot;:    &quot;full_name&quot;
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;name&quot;: {
    &quot;first&quot;:  &quot;John&quot;,
    &quot;middle&quot;: &quot;Winston&quot;,
    &quot;last&quot;:   &quot;Lennon&quot;
  }
}
</code></pre></div><p>请注意，path_match 和 path_unmatch 参数除了与叶字段相匹配外，还与对象路径相匹配。例如，为下面的文档建立索引会导致一个错误，因为 path_match 设置也匹配对象字段 name.title，它不能被映射为文本:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/_doc/2
{
  &quot;name&quot;: {
    &quot;first&quot;:  &quot;Paul&quot;,
    &quot;last&quot;:   &quot;McCartney&quot;,
    &quot;title&quot;: {
      &quot;value&quot;: &quot;Sir&quot;,
      &quot;category&quot;: &quot;order of chivalry&quot;
    }
  }
}
</code></pre></div><h2 id="模板变量"><a href="#模板变量" class="header-anchor">#</a> 模板变量</h2> <p>在与字段名称和检测到的动态类型的映射中替换{ name }和{ dynamic_type }占位符。下面的示例设置所有字符串字段，使用与字段同名的分析器，并禁用所有非字符串字段的 doc_value:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;named_analyzers&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;match&quot;: &quot;*&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;analyzer&quot;: &quot;{name}&quot;
          }
        }
      },
      {
        &quot;no_doc_values&quot;: {
          &quot;match_mapping_type&quot;:&quot;*&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;{dynamic_type}&quot;,
            &quot;doc_values&quot;: false
          }
        }
      }
    ]
  }
}

PUT my-index-000001/_doc/1
{
  &quot;english&quot;: &quot;Some English text&quot;, 
  &quot;count&quot;:   5 
}
</code></pre></div><ul><li>英文字段被映射为带有英文分析器的字符串字段。</li> <li>count 字段映射为禁用 doc_值的长字段。</li></ul> <h2 id="动态模板示例"><a href="#动态模板示例" class="header-anchor">#</a> 动态模板示例</h2> <p>下面是一些可能有用的动态模板的例子:</p> <h3 id="结构化搜索"><a href="#结构化搜索" class="header-anchor">#</a> 结构化搜索</h3> <p>当您设置&quot; dynamic&quot;: &quot;true&quot;时，Elasticsearch 将把字符串字段映射为带有关键字子字段的文本字段。如果你只是索引结构化内容或者对全文搜索不感兴趣，你可以使 Elasticsearch 只把你的字段作为关键字字段。但是，必须搜索与索引搜索这些字段完全相同的值。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;keyword&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><h3 id="text-只有字符串的映射"><a href="#text-只有字符串的映射" class="header-anchor">#</a> text-只有字符串的映射</h3> <p>与前面的例子相反，如果你只关心字符串字段的全文搜索，而不打算运行聚合、排序或精确搜索，你可以告诉 Elasticsearch 将字符串映射为文本:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_text&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;
          }
        }
      }
    ]
  }
}
</code></pre></div><p>或者，您可以创建一个动态模板，将字符串字段映射为映射的运行时部分中的关键字字段。当 Elasticsearch 检测到类型为 string 的新字段时，这些字段将被创建为类型为 keyword 的运行时字段。</p> <p>虽然字符串字段不会被索引，但是它们的值存储在_source 中，可以用于搜索请求、聚合、筛选和排序。</p> <p>例如，下面的请求创建一个动态模板，将字符串字段映射为 keyword 类型的运行时字段。虽然运行时定义是空白的，新的字符串字段将被映射为基于 Elasticsearch 用于向映射添加字段类型的动态映射规则的关键字运行时字段。任何没有通过日期检测或数字检测的字符串都会自动映射为关键字:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;runtime&quot;: {}
        }
      }
    ]
  }
}
</code></pre></div><p>你索引一个简单的文档:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001/_doc/1
{
  &quot;english&quot;: &quot;Some English text&quot;,
  &quot;count&quot;:   5
}
</code></pre></div><p>当你查看映射时，你会看到英文字段是一个类型为 keyword 的运行时字段:</p> <div class="language- extra-class"><pre class="language-text"><code>GET  my-index-000001/_mapping
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>{
  &quot;my-index-000001&quot; : {
    &quot;mappings&quot; : {
      &quot;dynamic_templates&quot; : [
        {
          &quot;strings_as_keywords&quot; : {
            &quot;match_mapping_type&quot; : &quot;string&quot;,
            &quot;runtime&quot; : { }
          }
        }
      ],
      &quot;runtime&quot; : {
        &quot;english&quot; : {
          &quot;type&quot; : &quot;keyword&quot;
        }
      },
      &quot;properties&quot; : {
        &quot;count&quot; : {
          &quot;type&quot; : &quot;long&quot;
        }
      }
    }
  }
}
</code></pre></div><h3 id="禁用标准"><a href="#禁用标准" class="header-anchor">#</a> 禁用标准</h3> <p>常模为指数时间评分因子。如果您不关心计分，例如，如果您从来不按分数对文档进行排序，那么您可以禁用索引中这些计分因子的存储并节省一些空间。</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;strings_as_keywords&quot;: {
          &quot;match_mapping_type&quot;: &quot;string&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;norms&quot;: false,
            &quot;fields&quot;: {
              &quot;keyword&quot;: {
                &quot;type&quot;: &quot;keyword&quot;,
                &quot;ignore_above&quot;: 256
              }
            }
          }
        }
      }
    ]
  }
}
</code></pre></div><p>子关键字字段在此模板中显示为与动态映射的默认规则一致。当然，如果您不需要它们，因为您不需要对这个字段执行精确的搜索或聚合，那么您可以按照前面部分的描述移除它。</p> <h3 id="时间序列"><a href="#时间序列" class="header-anchor">#</a> 时间序列</h3> <p>在使用 Elasticsearch 进行时间序列分析时，通常会有许多数字字段，您经常会对这些字段进行聚合，但是不会对其进行过滤。在这种情况下，你可以禁用这些字段的索引，以节省磁盘空间，也许还可以获得一些索引速度:</p> <div class="language- extra-class"><pre class="language-text"><code>PUT my-index-000001
{
  &quot;mappings&quot;: {
    &quot;dynamic_templates&quot;: [
      {
        &quot;unindexed_longs&quot;: {
          &quot;match_mapping_type&quot;: &quot;long&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;long&quot;,
            &quot;index&quot;: false
          }
        }
      },
      {
        &quot;unindexed_doubles&quot;: {
          &quot;match_mapping_type&quot;: &quot;double&quot;,
          &quot;mapping&quot;: {
            &quot;type&quot;: &quot;float&quot;, 
            &quot;index&quot;: false
          }
        }
      }
    ]
  }
}
</code></pre></div><ul><li>与默认的动态映射规则一样，双精度打印被映射为浮点数，这通常足够精确，但需要一半的磁盘空间。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/21/2021, 1:25:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/数据库/Elasticsearch/深入学习/映射-1.动态字段映射.html" class="prev">
        动态字段映射
      </a></span> <span class="next"><a href="/blog/数据库/Elasticsearch/深入学习/映射-3.元字段.html">
        元字段
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.b472f60d.js" defer></script><script src="/blog/assets/js/3.21e2e031.js" defer></script><script src="/blog/assets/js/150.6514db42.js" defer></script>
  </body>
</html>
