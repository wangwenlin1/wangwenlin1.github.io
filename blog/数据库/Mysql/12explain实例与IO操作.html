<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>explain实例与IO操作 | 一名GO+PHP工程师</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.bef719fb.css" as="style"><link rel="preload" href="/blog/assets/js/app.77332b34.js" as="script"><link rel="preload" href="/blog/assets/js/3.21e2e031.js" as="script"><link rel="preload" href="/blog/assets/js/56.3be1bfea.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.6084136f.js"><link rel="prefetch" href="/blog/assets/js/100.d5cb88cb.js"><link rel="prefetch" href="/blog/assets/js/101.6bbce255.js"><link rel="prefetch" href="/blog/assets/js/102.968ea43c.js"><link rel="prefetch" href="/blog/assets/js/103.c5c5130e.js"><link rel="prefetch" href="/blog/assets/js/104.161b590d.js"><link rel="prefetch" href="/blog/assets/js/105.eaae1ece.js"><link rel="prefetch" href="/blog/assets/js/106.9b961ba0.js"><link rel="prefetch" href="/blog/assets/js/107.df9ba599.js"><link rel="prefetch" href="/blog/assets/js/108.1e4967d1.js"><link rel="prefetch" href="/blog/assets/js/109.bab44539.js"><link rel="prefetch" href="/blog/assets/js/11.2e1457a2.js"><link rel="prefetch" href="/blog/assets/js/110.975b5aeb.js"><link rel="prefetch" href="/blog/assets/js/111.4db6087d.js"><link rel="prefetch" href="/blog/assets/js/112.bb76db96.js"><link rel="prefetch" href="/blog/assets/js/113.9b314292.js"><link rel="prefetch" href="/blog/assets/js/114.b05dc902.js"><link rel="prefetch" href="/blog/assets/js/115.6a21a21a.js"><link rel="prefetch" href="/blog/assets/js/116.1fd8cdf3.js"><link rel="prefetch" href="/blog/assets/js/117.193b54e8.js"><link rel="prefetch" href="/blog/assets/js/118.a54057c2.js"><link rel="prefetch" href="/blog/assets/js/119.857d484f.js"><link rel="prefetch" href="/blog/assets/js/12.48cd3c41.js"><link rel="prefetch" href="/blog/assets/js/120.c2fc1bab.js"><link rel="prefetch" href="/blog/assets/js/121.5bda4d33.js"><link rel="prefetch" href="/blog/assets/js/122.8ce24886.js"><link rel="prefetch" href="/blog/assets/js/123.90357e37.js"><link rel="prefetch" href="/blog/assets/js/124.2d89e041.js"><link rel="prefetch" href="/blog/assets/js/125.7be39e4f.js"><link rel="prefetch" href="/blog/assets/js/126.598ad722.js"><link rel="prefetch" href="/blog/assets/js/127.06c981b6.js"><link rel="prefetch" href="/blog/assets/js/128.ebd5e805.js"><link rel="prefetch" href="/blog/assets/js/129.b4fdbe4d.js"><link rel="prefetch" href="/blog/assets/js/13.b814da2c.js"><link rel="prefetch" href="/blog/assets/js/130.50ee8d35.js"><link rel="prefetch" href="/blog/assets/js/131.5f734cd7.js"><link rel="prefetch" href="/blog/assets/js/132.cb85c88a.js"><link rel="prefetch" href="/blog/assets/js/133.581b5e6c.js"><link rel="prefetch" href="/blog/assets/js/134.6a6cf86d.js"><link rel="prefetch" href="/blog/assets/js/135.313b60a3.js"><link rel="prefetch" href="/blog/assets/js/136.41c7a62b.js"><link rel="prefetch" href="/blog/assets/js/137.feeb7b80.js"><link rel="prefetch" href="/blog/assets/js/138.ddd4d1f7.js"><link rel="prefetch" href="/blog/assets/js/139.b13aa419.js"><link rel="prefetch" href="/blog/assets/js/14.d54ba5e3.js"><link rel="prefetch" href="/blog/assets/js/140.c2741475.js"><link rel="prefetch" href="/blog/assets/js/141.85f894e1.js"><link rel="prefetch" href="/blog/assets/js/142.8f3573aa.js"><link rel="prefetch" href="/blog/assets/js/143.e16816e7.js"><link rel="prefetch" href="/blog/assets/js/144.c91db5db.js"><link rel="prefetch" href="/blog/assets/js/145.95b58ec4.js"><link rel="prefetch" href="/blog/assets/js/146.92cd1d56.js"><link rel="prefetch" href="/blog/assets/js/147.1aad7186.js"><link rel="prefetch" href="/blog/assets/js/148.b0a6ba25.js"><link rel="prefetch" href="/blog/assets/js/149.cf51c7a4.js"><link rel="prefetch" href="/blog/assets/js/15.5840ca25.js"><link rel="prefetch" href="/blog/assets/js/150.8961d634.js"><link rel="prefetch" href="/blog/assets/js/151.9b1a9135.js"><link rel="prefetch" href="/blog/assets/js/152.d4fcbdac.js"><link rel="prefetch" href="/blog/assets/js/153.8f0df288.js"><link rel="prefetch" href="/blog/assets/js/154.3108e3fe.js"><link rel="prefetch" href="/blog/assets/js/155.1c76998b.js"><link rel="prefetch" href="/blog/assets/js/156.e514afd4.js"><link rel="prefetch" href="/blog/assets/js/157.d4566baf.js"><link rel="prefetch" href="/blog/assets/js/158.f649eaa4.js"><link rel="prefetch" href="/blog/assets/js/159.bde474db.js"><link rel="prefetch" href="/blog/assets/js/16.5bdde5ee.js"><link rel="prefetch" href="/blog/assets/js/160.567a6feb.js"><link rel="prefetch" href="/blog/assets/js/161.d8d1d0f9.js"><link rel="prefetch" href="/blog/assets/js/162.d7e72e4d.js"><link rel="prefetch" href="/blog/assets/js/163.33c153d8.js"><link rel="prefetch" href="/blog/assets/js/164.80cca623.js"><link rel="prefetch" href="/blog/assets/js/165.1d0cd529.js"><link rel="prefetch" href="/blog/assets/js/166.b73822d1.js"><link rel="prefetch" href="/blog/assets/js/167.1d799555.js"><link rel="prefetch" href="/blog/assets/js/168.281ad92f.js"><link rel="prefetch" href="/blog/assets/js/169.64dd7e3e.js"><link rel="prefetch" href="/blog/assets/js/17.5259d9eb.js"><link rel="prefetch" href="/blog/assets/js/170.e097186e.js"><link rel="prefetch" href="/blog/assets/js/171.ff778380.js"><link rel="prefetch" href="/blog/assets/js/172.6f3b63ce.js"><link rel="prefetch" href="/blog/assets/js/173.fc6d4e6a.js"><link rel="prefetch" href="/blog/assets/js/174.ae15fd8c.js"><link rel="prefetch" href="/blog/assets/js/175.bbae3a5c.js"><link rel="prefetch" href="/blog/assets/js/176.0b0e42b6.js"><link rel="prefetch" href="/blog/assets/js/177.1ff80e7e.js"><link rel="prefetch" href="/blog/assets/js/178.7f4bf5e6.js"><link rel="prefetch" href="/blog/assets/js/18.935f6748.js"><link rel="prefetch" href="/blog/assets/js/19.bee643b6.js"><link rel="prefetch" href="/blog/assets/js/2.97a298f6.js"><link rel="prefetch" href="/blog/assets/js/20.0f6c34c0.js"><link rel="prefetch" href="/blog/assets/js/21.c4b2e86b.js"><link rel="prefetch" href="/blog/assets/js/22.670160bc.js"><link rel="prefetch" href="/blog/assets/js/23.3ea9a5a9.js"><link rel="prefetch" href="/blog/assets/js/24.fded9b7a.js"><link rel="prefetch" href="/blog/assets/js/25.7a8d93d4.js"><link rel="prefetch" href="/blog/assets/js/26.4962fc80.js"><link rel="prefetch" href="/blog/assets/js/27.9f30f2c0.js"><link rel="prefetch" href="/blog/assets/js/28.dad4d7ea.js"><link rel="prefetch" href="/blog/assets/js/29.40a388e9.js"><link rel="prefetch" href="/blog/assets/js/30.09ea8215.js"><link rel="prefetch" href="/blog/assets/js/31.6a746a11.js"><link rel="prefetch" href="/blog/assets/js/32.30794034.js"><link rel="prefetch" href="/blog/assets/js/33.8fe12a68.js"><link rel="prefetch" href="/blog/assets/js/34.6ae8ca61.js"><link rel="prefetch" href="/blog/assets/js/35.770b0123.js"><link rel="prefetch" href="/blog/assets/js/36.aecfaf6e.js"><link rel="prefetch" href="/blog/assets/js/37.9eaa4368.js"><link rel="prefetch" href="/blog/assets/js/38.9037e52f.js"><link rel="prefetch" href="/blog/assets/js/39.bfc61cab.js"><link rel="prefetch" href="/blog/assets/js/4.fc4084f6.js"><link rel="prefetch" href="/blog/assets/js/40.4037bb53.js"><link rel="prefetch" href="/blog/assets/js/41.5b45d852.js"><link rel="prefetch" href="/blog/assets/js/42.eda4343c.js"><link rel="prefetch" href="/blog/assets/js/43.f1402b09.js"><link rel="prefetch" href="/blog/assets/js/44.c8598baf.js"><link rel="prefetch" href="/blog/assets/js/45.394124a5.js"><link rel="prefetch" href="/blog/assets/js/46.d684210c.js"><link rel="prefetch" href="/blog/assets/js/47.b05a79df.js"><link rel="prefetch" href="/blog/assets/js/48.09f94403.js"><link rel="prefetch" href="/blog/assets/js/49.cffe09bd.js"><link rel="prefetch" href="/blog/assets/js/5.3f398ea8.js"><link rel="prefetch" href="/blog/assets/js/50.bbc144de.js"><link rel="prefetch" href="/blog/assets/js/51.29fb5c68.js"><link rel="prefetch" href="/blog/assets/js/52.d2042f8d.js"><link rel="prefetch" href="/blog/assets/js/53.274cd25d.js"><link rel="prefetch" href="/blog/assets/js/54.38b1f6bf.js"><link rel="prefetch" href="/blog/assets/js/55.466512f8.js"><link rel="prefetch" href="/blog/assets/js/57.c919083e.js"><link rel="prefetch" href="/blog/assets/js/58.88f9f57c.js"><link rel="prefetch" href="/blog/assets/js/59.d78a1017.js"><link rel="prefetch" href="/blog/assets/js/6.02a67347.js"><link rel="prefetch" href="/blog/assets/js/60.85f7e060.js"><link rel="prefetch" href="/blog/assets/js/61.7f5a0117.js"><link rel="prefetch" href="/blog/assets/js/62.107841bb.js"><link rel="prefetch" href="/blog/assets/js/63.e52b96f1.js"><link rel="prefetch" href="/blog/assets/js/64.68cd3b45.js"><link rel="prefetch" href="/blog/assets/js/65.4f8891d2.js"><link rel="prefetch" href="/blog/assets/js/66.d83bdb2e.js"><link rel="prefetch" href="/blog/assets/js/67.56a423d5.js"><link rel="prefetch" href="/blog/assets/js/68.b57a2648.js"><link rel="prefetch" href="/blog/assets/js/69.84ae7ab6.js"><link rel="prefetch" href="/blog/assets/js/7.e9a4f415.js"><link rel="prefetch" href="/blog/assets/js/70.8185c301.js"><link rel="prefetch" href="/blog/assets/js/71.e92a9144.js"><link rel="prefetch" href="/blog/assets/js/72.78fc6941.js"><link rel="prefetch" href="/blog/assets/js/73.ca28169a.js"><link rel="prefetch" href="/blog/assets/js/74.5ba3efb6.js"><link rel="prefetch" href="/blog/assets/js/75.65e4ac58.js"><link rel="prefetch" href="/blog/assets/js/76.19907955.js"><link rel="prefetch" href="/blog/assets/js/77.d93015d9.js"><link rel="prefetch" href="/blog/assets/js/78.011dc4e2.js"><link rel="prefetch" href="/blog/assets/js/79.8204d6d2.js"><link rel="prefetch" href="/blog/assets/js/8.de76593a.js"><link rel="prefetch" href="/blog/assets/js/80.55ae373f.js"><link rel="prefetch" href="/blog/assets/js/81.04f50a1e.js"><link rel="prefetch" href="/blog/assets/js/82.db879ca5.js"><link rel="prefetch" href="/blog/assets/js/83.e89b8863.js"><link rel="prefetch" href="/blog/assets/js/84.07410b58.js"><link rel="prefetch" href="/blog/assets/js/85.d46c8682.js"><link rel="prefetch" href="/blog/assets/js/86.52351591.js"><link rel="prefetch" href="/blog/assets/js/87.c4ebf9a8.js"><link rel="prefetch" href="/blog/assets/js/88.09fc332a.js"><link rel="prefetch" href="/blog/assets/js/89.8b302469.js"><link rel="prefetch" href="/blog/assets/js/9.41767da0.js"><link rel="prefetch" href="/blog/assets/js/90.391f76ed.js"><link rel="prefetch" href="/blog/assets/js/91.b9d1bb73.js"><link rel="prefetch" href="/blog/assets/js/92.a65aa479.js"><link rel="prefetch" href="/blog/assets/js/93.bc850b53.js"><link rel="prefetch" href="/blog/assets/js/94.7dc858d7.js"><link rel="prefetch" href="/blog/assets/js/95.83afadb6.js"><link rel="prefetch" href="/blog/assets/js/96.85084d66.js"><link rel="prefetch" href="/blog/assets/js/97.68a76e8c.js"><link rel="prefetch" href="/blog/assets/js/98.fdb7d67a.js"><link rel="prefetch" href="/blog/assets/js/99.c4b1cfd7.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.bef719fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一名GO+PHP工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Mysql/1视图-触发器-存储过程" class="sidebar-heading clickable open"><span>Mysql</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Mysql/1视图-触发器-存储过程.html" class="sidebar-link">视图，存储过程，触发器</a></li><li><a href="/blog/数据库/Mysql/2物化视图-事务.html" class="sidebar-link">物化视图-事务</a></li><li><a href="/blog/数据库/Mysql/3事务日志与锁初体验.html" class="sidebar-link">事务与锁</a></li><li><a href="/blog/数据库/Mysql/4事务隔离与锁的关系.html" class="sidebar-link">事务隔离与锁的关系</a></li><li><a href="/blog/数据库/Mysql/5锁机制与数据库结构.html" class="sidebar-link">锁机制与数据库结构</a></li><li><a href="/blog/数据库/Mysql/6数据库文件.html" class="sidebar-link">数据库结构</a></li><li><a href="/blog/数据库/Mysql/7结构与存储引擎.html" class="sidebar-link">数据库结构详解</a></li><li><a href="/blog/数据库/Mysql/8发现问题.html" class="sidebar-link">问题发现</a></li><li><a href="/blog/数据库/Mysql/9数据库的基础设计.html" class="sidebar-link">数据库基础设计与表设计</a></li><li><a href="/blog/数据库/Mysql/10数据库字段选择与sql执行.html" class="sidebar-link">数据表字段选择与SQL执行流程</a></li><li><a href="/blog/数据库/Mysql/11sql分析.html" class="sidebar-link">sql分析</a></li><li><a href="/blog/数据库/Mysql/12explain实例与IO操作.html" class="active sidebar-link">explain实例与IO操作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/数据库/Mysql/13SQL执行IO操作及索引基础.html" class="sidebar-link">SQL执行IO操作及索引基础</a></li><li><a href="/blog/数据库/Mysql/14索引基础.html" class="sidebar-link">索引基础</a></li><li><a href="/blog/数据库/Mysql/15SQL优化实例.html" class="sidebar-link">SQL优化案例实践</a></li><li><a href="/blog/数据库/Mysql/16join初步.html" class="sidebar-link">join 初步</a></li><li><a href="/blog/数据库/Mysql/17join优化思路.html" class="sidebar-link">join优化以及条件解析</a></li><li><a href="/blog/数据库/Mysql/20索引总结iCP与where提取.html" class="sidebar-link">索引总结iCP与where提取</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="explain实例与io操作"><a href="#explain实例与io操作" class="header-anchor">#</a> explain实例与IO操作</h1> <h3 id="_1-课程内容"><a href="#_1-课程内容" class="header-anchor">#</a> 1. 课程内容</h3> <pre>1. 课程回顾
   1.1 SQL语句的过强和过弱的使用
   1.2 优化SQL的思路-----------(重点)
   1.3 explain分析------------(重点 -- 不算难 -- 就是需要记记)
2. explain分析简单实例
3. profiling分析
4. MySQL数据磁盘IO操作
5. Btree结构
</pre> <h3 id="_2-explain分析简单实例"><a href="#_2-explain分析简单实例" class="header-anchor">#</a> 2. explain分析简单实例</h3> <p>以及MySQL5.7的order与group的问题</p> <p>题目 =》 其余题目当做作业吧</p> <p><img src="/blog/assets/img/11.e3f6aec3.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code>  单表
  <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>customers1<span class="token punctuation">`</span> <span class="token punctuation">(</span>
      <span class="token comment">-- 身份证</span>
      <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 姓名</span>
      <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 城市名</span>
      <span class="token punctuation">`</span>city<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 性别：M（男），G（女）</span>
      <span class="token punctuation">`</span>gender<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 出生日期</span>
      <span class="token punctuation">`</span>birthdate<span class="token punctuation">`</span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 手机号</span>
      <span class="token punctuation">`</span>mobile<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 照片</span>
      <span class="token punctuation">`</span>photo<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 月薪</span>
      <span class="token punctuation">`</span>monthsalary<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token comment">-- 年奖金额</span>
      <span class="token punctuation">`</span>yearbonus<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
  分表
  <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>customers<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>city<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>gender<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>birthdate<span class="token punctuation">`</span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>mobile<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>photo<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8

  <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>salary<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>monthsalary<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>yearbonus<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8

  测试数据用自己写的批量添加测试数据的方法添加吧，在此不提供哟
</code></pre></div><ol><li>女性客户数量和平均月薪</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> indexes <span class="token keyword">from</span> customers<span class="token punctuation">;</span>
<span class="token keyword">show</span> indexes <span class="token keyword">from</span> customers1<span class="token punctuation">;</span>
<span class="token keyword">show</span> indexes <span class="token keyword">from</span> salary<span class="token punctuation">;</span>


<span class="token keyword">alter</span> <span class="token keyword">table</span> salary <span class="token keyword">drop</span> <span class="token keyword">index</span> city_monthsalary
<span class="token keyword">alter</span> <span class="token keyword">table</span> customers <span class="token keyword">add</span> <span class="token keyword">index</span> city_monthsalary<span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>

单表操作 customers1
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">.</span>monthsalary<span class="token punctuation">)</span> <span class="token keyword">from</span> customers <span class="token keyword">left</span> <span class="token keyword">join</span>  salary <span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> salary<span class="token punctuation">.</span>id <span class="token keyword">where</span> customers<span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>

两表操作；
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">.</span>monthsalary<span class="token punctuation">)</span> <span class="token keyword">from</span> customers <span class="token keyword">left</span> <span class="token keyword">join</span>  salary <span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> salary<span class="token punctuation">.</span>id <span class="token keyword">where</span> customers<span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------+------------+--------+---------------+---------+---------+----------------------+-------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>     <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref                  <span class="token operator">|</span> <span class="token keyword">rows</span>  <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------+------------+--------+---------------+---------+---------+----------------------+-------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>                 <span class="token operator">|</span> <span class="token number">19638</span> <span class="token operator">|</span>    <span class="token number">10.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>

<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> salary    <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">60</span>      <span class="token operator">|</span> mysql12<span class="token punctuation">.</span>customers<span class="token punctuation">.</span>id <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-----------+------------+--------+---------------+---------+---------+----------------------+-------+----------+-------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>优化操作：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">1</span>、单表：
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">948806</span> <span class="token operator">|</span>    <span class="token number">10.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>


首先要做的就是分析结构；通过<span class="token keyword">explain</span>去分析；

从<span class="token keyword">explain</span>分析 <span class="token keyword">type</span> 可以看出来这个时候的<span class="token keyword">SQL</span>是进行了全表的扫描；<span class="token keyword">key</span><span class="token punctuation">(</span>查询实际用到的索引<span class="token punctuation">)</span>与possible_keys<span class="token punctuation">(</span>指出使用那个索引<span class="token punctuation">)</span>key_len<span class="token punctuation">(</span>索引的长度<span class="token punctuation">)</span> 而extra为useing <span class="token keyword">where</span>

简单来说就是这个查询就是对于整个数据表进行了全表的扫描，没有使用到索引过滤；而主要的过滤条件就是<span class="token keyword">where</span> 也就是gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

这个时候我们可以建立索引尝试着去优化，对于索引的建立有很多的规则；之后再去细细解释；

根据索引的建立的规则<span class="token operator">-</span>》把<span class="token keyword">SQL</span>分解

索引应该创建在搜索、排序、归组等操作所涉及的数据列上，旨在输出报告里出现的数据列不是好的候选。 简单点就是在<span class="token keyword">where</span>字句、关联检索中的<span class="token keyword">from</span>字句、<span class="token keyword">order</span> 与 <span class="token keyword">group</span> 字句中出现的数据列最适合用来创建索引。只在<span class="token keyword">select</span>关键字后面输出列清单例出现过的数据列并不是好的候选

<span class="token keyword">select</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span> <span class="token comment">-- 考虑一下</span>
<span class="token keyword">from</span>
  customers1
<span class="token keyword">where</span>
  gender <span class="token operator">=</span> <span class="token number">0</span>                <span class="token comment">-- 这个不错</span>

其他规则<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>过过过 之后细细分解

所以这个时候那么这个时候最合适创建索引的字段就是gender，执行<span class="token keyword">alter</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> customers1 <span class="token keyword">add</span> <span class="token keyword">index</span> gender<span class="token punctuation">(</span>gender<span class="token punctuation">)</span><span class="token punctuation">;</span>

执行之后这个时候还是需要通过 <span class="token keyword">explain</span>分析一下数据的情况
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> gender        <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

从分析的结果来看
<span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>
ref  <span class="token operator">|</span> gender        <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span>

使用了刚刚创建的索引<span class="token punctuation">,</span>长度为<span class="token number">1</span> 并且是为常量的方式查找

但是这里的extra为空，注意这个点；为空 ？？？先不纠结测试，但是测试的结果很尴尬

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token operator">|</span>   <span class="token number">651457</span> <span class="token operator">|</span>      <span class="token number">5004.957393</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">41.58</span> sec<span class="token punctuation">)</span>

并没有起到很好地效果？？？？？？？？ 为什么???? 其实这里的话就设计到了索引的设计以及查找的情况，主要的问题在于 索引回表（之后解释）了导致时间增长，那这个时候怎么优化呢？？

思路的话可以分解<span class="token keyword">select</span> 对于<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>进行单独测试看看效果；找出是那个部分的因素引起的

注意：单独对于<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> customers1 测试一下

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> gender        <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span> <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> gender        <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

可以看出来是<span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>引起的，也就是说我们只需要把 <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span> <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 这个优化好了那么就可以了其实avg与count一样在MySQL操作的时候也会自动的匹配一个合适的索引，而count的默认匹配索引是主键，但是在我们上面的操作环节中因为给customers1创建了一个索引gender 这个时候<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>在操作的时候就会以gender作为辅助索引使用。

而在上面的语句中仅仅只是根据 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span> 过滤了查找的内容，但是在进行数据avg的时候这个时候就是需要去进行IO获取数据具体的数据，MySQL在辅助索引操作的时候如果无法从辅助索引中获取数据这个时候就会再去查询一级索引主键根据主键获取数据再做计算；所以为了与更好的进行monthsalary 的avg操作我们应该要给monthsalary建立一个索引

<span class="token keyword">alter</span> <span class="token keyword">table</span> customers1 <span class="token keyword">add</span> <span class="token keyword">index</span> monthsalary<span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span><span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+-------+---------------+-------------+---------+------+---------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>         <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span>    <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+-------+---------------+-------------+---------+------+---------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> monthsalary <span class="token operator">|</span> <span class="token number">5</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1305211</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+-------+---------------+-------------+---------+------+---------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>    <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> gender        <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+---------------+--------+---------+-------+--------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

o<span class="token punctuation">(</span>▼皿▼メ<span class="token punctuation">;</span><span class="token punctuation">)</span>o怎么还是使用了gender索引 <span class="token punctuation">(</span>⊙_⊙<span class="token punctuation">)</span>? 其实这就是MySQL对于一个表的索引的选择的关系，MySQL只会选择与最合适的哪一个索引而不是使用所有的索引，在上面的查询中最为合适的就是 gender

这里最好的处理就是建立一个 gender 与 monthsalary的联合索引； 删除之前的索引

<span class="token keyword">alter</span> <span class="token keyword">table</span> customers1 <span class="token keyword">drop</span> <span class="token keyword">index</span> monthsalary<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> customers1 <span class="token keyword">drop</span> <span class="token keyword">index</span> gender<span class="token punctuation">;</span>

<span class="token keyword">alter</span> <span class="token keyword">table</span> customers1 <span class="token keyword">add</span> <span class="token keyword">index</span> gender_monthsalary<span class="token punctuation">(</span>gender<span class="token punctuation">,</span> monthsalary<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> 注意顺序，gender在前

然后测试

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+--------------------+--------------------+---------+-------+--------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys      <span class="token operator">|</span> <span class="token keyword">key</span>                <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+--------------------+--------------------+---------+-------+--------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> customers1 <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> gender_monthsalary <span class="token operator">|</span> gender_monthsalary <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">652605</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+------+--------------------+--------------------+---------+-------+--------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

实际执行

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span>  <span class="token keyword">from</span> customers1 <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">avg</span><span class="token punctuation">(</span>monthsalary<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token operator">|</span>   <span class="token number">651457</span> <span class="token operator">|</span>      <span class="token number">5004.957393</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.17</span> sec<span class="token punctuation">)</span>

<span class="token keyword">explain</span> 优化指标
systme<span class="token operator">&gt;</span>const<span class="token operator">&gt;</span>eq_ref<span class="token operator">&gt;</span>ref<span class="token operator">&gt;</span>fulltext<span class="token operator">&gt;</span>ref_or_null<span class="token operator">&gt;</span>index_merge<span class="token operator">&gt;</span>unique_subquery<span class="token operator">&gt;</span>index_subquery<span class="token operator">&gt;</span>range<span class="token operator">&gt;</span><span class="token keyword">index</span><span class="token operator">&gt;</span><span class="token keyword">all</span>

<span class="token number">1.</span>const
如果是根据主键或唯一索引 只取出确定的一行数据。是最快的一种。
<span class="token number">2.</span>range
索引或主键，在某个范围内时
<span class="token number">3.</span><span class="token keyword">index</span>
仅仅只有索引被扫描
<span class="token number">4.</span><span class="token keyword">all</span>
全表扫描，最令人心痛

</code></pre></div><h3 id="_3-profiling分析"><a href="#_3-profiling分析" class="header-anchor">#</a> 3. profiling分析</h3> <p>要想有画一条query，就需要清楚这条query的性能瓶颈到底在哪里，mysql的profiler是一个使用非常方便的查询诊断分析工具，通过该工具可以获取一条查询在整个执行过程中多种资源的消耗情况，例如内存消耗、I/O消耗和CPU消耗等。</p> <p>profile的语法规则如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> profile <span class="token punctuation">[</span><span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">for</span> query n<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">limit</span> row_count <span class="token punctuation">[</span><span class="token keyword">offset</span> <span class="token keyword">offset</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>其中type参数的可选项含义如下：</p> <ul><li>all：显示所有的信息</li> <li>block io：限时输入输出操作阻塞的数量</li> <li>context switches：显示自动或非自动context switches的数量</li> <li>cpu：显示系统和用户cpu使用的时间</li> <li>ipc：显示信息发送和接受的数量</li> <li>memory：内存的信息</li> <li>page faults：显示主要的page faults数量</li> <li>source：显示函数的名称，并且系那是函数所在文件的名字和行数</li> <li>swaps：显示swap数量</li></ul> <p>开启profile</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>community<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> profiling <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>在开启了query profiler功能之后，mysql就会自动记录所有执行的query的profile信息。下面执行query</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> admin_user_copy
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> purchase_order
</code></pre></div><p>通过执行 <code>show profile</code> 命令获取当前系统中保存的多个query的profile的概要信息。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>community<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--------------------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--------------------------------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1.43076000</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> admin_user_copy <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.35574100</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> purchase_order  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+--------------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p><em>针对单个query获取详细的profile的信息</em></p> <p>在获取概要信息之后就可以根据概要信息中的query_id来获取某一个query在执行过程中的profile信息了</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>community<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>               <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>             <span class="token operator">|</span> <span class="token number">0.000069</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000035</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">After</span> opening <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>          <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token keyword">lock</span>           <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                 <span class="token operator">|</span> <span class="token number">0.000015</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing           <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>           <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing            <span class="token operator">|</span> <span class="token number">0.000021</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing            <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span>
<span class="token operator">|</span> Sending <span class="token keyword">data</span>         <span class="token operator">|</span> <span class="token number">1.430456</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                  <span class="token operator">|</span> <span class="token number">0.000020</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>            <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> Unlocking <span class="token keyword">tables</span>     <span class="token operator">|</span> <span class="token number">0.000013</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items        <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span>
<span class="token operator">|</span> updating <span class="token keyword">status</span>      <span class="token operator">|</span> <span class="token number">0.000027</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up          <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+</span>

MariaDB <span class="token punctuation">[</span>community<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+--------------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>               <span class="token operator">|</span> Duration <span class="token operator">|</span> CPU_user <span class="token operator">|</span> CPU_system <span class="token operator">|</span> Block_ops_in <span class="token operator">|</span> Block_ops_out <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+--------------+---------------+</span>
<span class="token operator">|</span> <span class="token keyword">starting</span>             <span class="token operator">|</span> <span class="token number">0.000069</span> <span class="token operator">|</span> <span class="token number">0.000058</span> <span class="token operator">|</span>   <span class="token number">0.000011</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>   <span class="token number">0.000011</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000035</span> <span class="token operator">|</span> <span class="token number">0.000033</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">After</span> opening <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>          <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Table</span> <span class="token keyword">lock</span>           <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000006</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                 <span class="token operator">|</span> <span class="token number">0.000015</span> <span class="token operator">|</span> <span class="token number">0.000014</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> optimizing           <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">statistics</span>           <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span> <span class="token number">0.000018</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> preparing            <span class="token operator">|</span> <span class="token number">0.000021</span> <span class="token operator">|</span> <span class="token number">0.000019</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> executing            <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Sending <span class="token keyword">data</span>         <span class="token operator">|</span> <span class="token number">1.430456</span> <span class="token operator">|</span> <span class="token number">1.928391</span> <span class="token operator">|</span>   <span class="token number">0.113126</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">end</span>                  <span class="token operator">|</span> <span class="token number">0.000020</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000013</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> query <span class="token keyword">end</span>            <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>   <span class="token number">0.000002</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Unlocking <span class="token keyword">tables</span>     <span class="token operator">|</span> <span class="token number">0.000013</span> <span class="token operator">|</span> <span class="token number">0.000012</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> freeing items        <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> updating <span class="token keyword">status</span>      <span class="token operator">|</span> <span class="token number">0.000027</span> <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span>   <span class="token number">0.000020</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> cleaning up          <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000001</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+--------------+---------------+</span>
</code></pre></div><h3 id="_4-mysql-sql-io的操作"><a href="#_4-mysql-sql-io的操作" class="header-anchor">#</a> 4. MySQL -sql - IO的操作</h3> <h4 id="_4-1-innodb-磁盘的关系"><a href="#_4-1-innodb-磁盘的关系" class="header-anchor">#</a> 4.1 innodb - 磁盘的关系</h4> <p>对于MySQL来说数据是存在于磁盘中的，SQL主要就是通过MySQL的存储引擎的接口handler(sql/handler.cc)类进行数据的获取和操作。</p> <p>它提供了一些可实现基本操作的方法，如打开和关闭表，连续扫描记录、按照兼职检索记录、存储记录及删除记录。每个存储引擎都执行处理的一个子类以实现接口方法，一边将处理器操作转化为特定存储引擎的低层次存储/检索API调用。</p> <p>Innodb 存储引擎用于管理数据的最小磁盘单位。常见的页类型有数据页、Undo 页、系统页、事务数据页等，本文主要分析的是数据页。默认的页大小为 16KB，每个页中至少存储有 2 条或以上的行记录</p> <p>innodb存储引擎对于数据表结构 表空间(Tablespace) -》分片段(Segment) -》盘区(Extents) -》 页(page)</p> <p><img src="/blog/assets/img/table.d1310016.png" alt=""></p> <p><em>表空间：</em></p> <p>表空间分为了两种，这里简单的概括一下：</p> <ol><li>独立表空间：每一个表都将会生成以独立的文件方式来进行存储，每一个表都有一个.frm表描述文件，还有一个.ibd文件。 其中这个文件包括了单独一个表的数据内容以及索引内容，默认情况下它的存储位置也是在表的位置之中。</li> <li>共享表空间： Innodb的所有数据保存在一个单独的表空间里面，而这个表空间可以由很多个文件组成，一个表可以跨多个文件存在，所以其大小限制不再是文件大小的限制，而是其自身的限制。从Innodb的官方文档中可以看到，其表空间的最大限制为64TB，也就是说，Innodb的单表限制基本上也在64TB左右了，当然这个大小是包括这个表的所有索引等其他相关数据。</li></ol> <p>InnoDB把数据保存在表空间内，表空间可以看作是InnoDB存储引擎逻辑结构的最高层。本质上是一个由一个或多个磁盘文件组成的虚拟文件系统。InnoDB用表空间并不只是存储表和索引，还保存了回滚段、双写缓冲区等。</p> <p><em>分片段(Segment)</em></p> <p>段是表空间文件中的主要组织结构，它是一个逻辑概念，用来管理物理文件，是构成索引、表、回滚段的基本元素。</p> <p>创建一个索引（B+树）时会同时创建两个段，分别是内节点段和叶子段，内节点段用来管理（存储）B+树非叶子（页面）的数据，叶子段用来管理（存储）B+树叶子节点的数据；也就是说，在索引数据量一直增长的过程中，所有新的存储空间的申请，都是从“段”这个概念中申请的。</p> <p><em>盘区(Extents) -》 过</em></p> <p><em>页(page)</em></p> <p>页是InnoDB磁盘管理的最小单位 对于innodb来说就是 16KB 不过如果是oracle 或者SQLserver就是4kb的大小。</p> <p>常见的页类型有：</p> <ul><li>数据页（B-tree Node）。</li> <li>Undo页（Undo Log Page</li> <li>事务数据页（Transaction system Page）。</li> <li>索引行</li></ul> <p><img src="/blog/assets/img/22.47f7e809.png" alt=""></p> <hr> <p>如果想深入理解的 建议阅读文章 MySQL · 引擎特性 · InnoDB 文件系统之文件物理结构:https://blog.csdn.net/mysql_lover/article/details/54612876</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/21/2021, 1:25:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/数据库/Mysql/11sql分析.html" class="prev">
        sql分析
      </a></span> <span class="next"><a href="/blog/数据库/Mysql/13SQL执行IO操作及索引基础.html">
        SQL执行IO操作及索引基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.77332b34.js" defer></script><script src="/blog/assets/js/3.21e2e031.js" defer></script><script src="/blog/assets/js/56.3be1bfea.js" defer></script>
  </body>
</html>
