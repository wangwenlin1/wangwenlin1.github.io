<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库结构详解 | 一名GO+PHP工程师</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b3aba94c.css" as="style"><link rel="preload" href="/blog/assets/js/app.92f490ec.js" as="script"><link rel="preload" href="/blog/assets/js/3.21e2e031.js" as="script"><link rel="preload" href="/blog/assets/js/39.3191561f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.414eb148.js"><link rel="prefetch" href="/blog/assets/js/100.318655e6.js"><link rel="prefetch" href="/blog/assets/js/101.f359d9dc.js"><link rel="prefetch" href="/blog/assets/js/102.968ea43c.js"><link rel="prefetch" href="/blog/assets/js/103.c5c5130e.js"><link rel="prefetch" href="/blog/assets/js/104.30b376fe.js"><link rel="prefetch" href="/blog/assets/js/105.d99dabdd.js"><link rel="prefetch" href="/blog/assets/js/106.acdd49d2.js"><link rel="prefetch" href="/blog/assets/js/107.df9ba599.js"><link rel="prefetch" href="/blog/assets/js/108.a5880443.js"><link rel="prefetch" href="/blog/assets/js/109.bab44539.js"><link rel="prefetch" href="/blog/assets/js/11.5abb714c.js"><link rel="prefetch" href="/blog/assets/js/110.975b5aeb.js"><link rel="prefetch" href="/blog/assets/js/111.4db6087d.js"><link rel="prefetch" href="/blog/assets/js/112.bb76db96.js"><link rel="prefetch" href="/blog/assets/js/113.9b314292.js"><link rel="prefetch" href="/blog/assets/js/114.f28a4d47.js"><link rel="prefetch" href="/blog/assets/js/115.6a21a21a.js"><link rel="prefetch" href="/blog/assets/js/116.1fd8cdf3.js"><link rel="prefetch" href="/blog/assets/js/117.193b54e8.js"><link rel="prefetch" href="/blog/assets/js/118.8a3e18a9.js"><link rel="prefetch" href="/blog/assets/js/119.857d484f.js"><link rel="prefetch" href="/blog/assets/js/12.2c548c05.js"><link rel="prefetch" href="/blog/assets/js/120.3db2d63a.js"><link rel="prefetch" href="/blog/assets/js/121.a6adc6ef.js"><link rel="prefetch" href="/blog/assets/js/122.1b17fd59.js"><link rel="prefetch" href="/blog/assets/js/123.ee446c75.js"><link rel="prefetch" href="/blog/assets/js/124.c284df07.js"><link rel="prefetch" href="/blog/assets/js/125.5cbebbd8.js"><link rel="prefetch" href="/blog/assets/js/126.4adc2281.js"><link rel="prefetch" href="/blog/assets/js/127.975465e3.js"><link rel="prefetch" href="/blog/assets/js/128.f0625ed5.js"><link rel="prefetch" href="/blog/assets/js/129.c960281b.js"><link rel="prefetch" href="/blog/assets/js/13.7235498f.js"><link rel="prefetch" href="/blog/assets/js/130.3fa988b7.js"><link rel="prefetch" href="/blog/assets/js/131.ff0058e6.js"><link rel="prefetch" href="/blog/assets/js/132.9fd5bbe5.js"><link rel="prefetch" href="/blog/assets/js/133.37b40d8b.js"><link rel="prefetch" href="/blog/assets/js/134.3ea0a5d6.js"><link rel="prefetch" href="/blog/assets/js/135.243ca016.js"><link rel="prefetch" href="/blog/assets/js/136.12ac5b39.js"><link rel="prefetch" href="/blog/assets/js/137.50106a44.js"><link rel="prefetch" href="/blog/assets/js/138.2f799002.js"><link rel="prefetch" href="/blog/assets/js/139.cb5c4cb6.js"><link rel="prefetch" href="/blog/assets/js/14.8668d3e6.js"><link rel="prefetch" href="/blog/assets/js/140.b68497e2.js"><link rel="prefetch" href="/blog/assets/js/141.cd76190b.js"><link rel="prefetch" href="/blog/assets/js/142.e385a422.js"><link rel="prefetch" href="/blog/assets/js/143.fd923e68.js"><link rel="prefetch" href="/blog/assets/js/144.c91db5db.js"><link rel="prefetch" href="/blog/assets/js/145.95b58ec4.js"><link rel="prefetch" href="/blog/assets/js/146.0ff38d15.js"><link rel="prefetch" href="/blog/assets/js/147.9d236468.js"><link rel="prefetch" href="/blog/assets/js/148.b0a6ba25.js"><link rel="prefetch" href="/blog/assets/js/149.cf51c7a4.js"><link rel="prefetch" href="/blog/assets/js/15.b3be88a6.js"><link rel="prefetch" href="/blog/assets/js/150.6514db42.js"><link rel="prefetch" href="/blog/assets/js/151.544c42cb.js"><link rel="prefetch" href="/blog/assets/js/152.d3e57edd.js"><link rel="prefetch" href="/blog/assets/js/153.422a401e.js"><link rel="prefetch" href="/blog/assets/js/154.553067c9.js"><link rel="prefetch" href="/blog/assets/js/155.9b88d76c.js"><link rel="prefetch" href="/blog/assets/js/156.14a1e6f8.js"><link rel="prefetch" href="/blog/assets/js/157.c01cdccb.js"><link rel="prefetch" href="/blog/assets/js/158.71dda3a8.js"><link rel="prefetch" href="/blog/assets/js/159.33fa138a.js"><link rel="prefetch" href="/blog/assets/js/16.4c61d2b6.js"><link rel="prefetch" href="/blog/assets/js/160.41012461.js"><link rel="prefetch" href="/blog/assets/js/161.b2118a13.js"><link rel="prefetch" href="/blog/assets/js/162.39021ec7.js"><link rel="prefetch" href="/blog/assets/js/163.33c153d8.js"><link rel="prefetch" href="/blog/assets/js/164.80cca623.js"><link rel="prefetch" href="/blog/assets/js/165.d4170a5d.js"><link rel="prefetch" href="/blog/assets/js/166.8eb8df1e.js"><link rel="prefetch" href="/blog/assets/js/167.b4296d08.js"><link rel="prefetch" href="/blog/assets/js/168.e5ed439d.js"><link rel="prefetch" href="/blog/assets/js/169.4614ac4e.js"><link rel="prefetch" href="/blog/assets/js/17.7c194dc5.js"><link rel="prefetch" href="/blog/assets/js/170.4469c187.js"><link rel="prefetch" href="/blog/assets/js/171.58868926.js"><link rel="prefetch" href="/blog/assets/js/172.afe06d5f.js"><link rel="prefetch" href="/blog/assets/js/173.a4aa2efd.js"><link rel="prefetch" href="/blog/assets/js/174.ae15fd8c.js"><link rel="prefetch" href="/blog/assets/js/175.b1a13486.js"><link rel="prefetch" href="/blog/assets/js/176.548adc93.js"><link rel="prefetch" href="/blog/assets/js/177.11fee168.js"><link rel="prefetch" href="/blog/assets/js/178.7f4bf5e6.js"><link rel="prefetch" href="/blog/assets/js/18.8f993f6c.js"><link rel="prefetch" href="/blog/assets/js/19.07ebbe7d.js"><link rel="prefetch" href="/blog/assets/js/2.3b7603f9.js"><link rel="prefetch" href="/blog/assets/js/20.0f6c34c0.js"><link rel="prefetch" href="/blog/assets/js/21.e0c3e1c3.js"><link rel="prefetch" href="/blog/assets/js/22.f6717fe0.js"><link rel="prefetch" href="/blog/assets/js/23.4d536a42.js"><link rel="prefetch" href="/blog/assets/js/24.1249f968.js"><link rel="prefetch" href="/blog/assets/js/25.1d9c0595.js"><link rel="prefetch" href="/blog/assets/js/26.fc0335c7.js"><link rel="prefetch" href="/blog/assets/js/27.95428f76.js"><link rel="prefetch" href="/blog/assets/js/28.cebb0e44.js"><link rel="prefetch" href="/blog/assets/js/29.76ea8050.js"><link rel="prefetch" href="/blog/assets/js/30.e12a0501.js"><link rel="prefetch" href="/blog/assets/js/31.ad16795c.js"><link rel="prefetch" href="/blog/assets/js/32.763b7b98.js"><link rel="prefetch" href="/blog/assets/js/33.8fe12a68.js"><link rel="prefetch" href="/blog/assets/js/34.02b4c519.js"><link rel="prefetch" href="/blog/assets/js/35.86d13f87.js"><link rel="prefetch" href="/blog/assets/js/36.20e014f1.js"><link rel="prefetch" href="/blog/assets/js/37.f94ee385.js"><link rel="prefetch" href="/blog/assets/js/38.b73a2f0c.js"><link rel="prefetch" href="/blog/assets/js/4.b2ea88eb.js"><link rel="prefetch" href="/blog/assets/js/40.2943fb88.js"><link rel="prefetch" href="/blog/assets/js/41.6201f829.js"><link rel="prefetch" href="/blog/assets/js/42.4b6a9c5d.js"><link rel="prefetch" href="/blog/assets/js/43.34c54b98.js"><link rel="prefetch" href="/blog/assets/js/44.c0141c7c.js"><link rel="prefetch" href="/blog/assets/js/45.d4760744.js"><link rel="prefetch" href="/blog/assets/js/46.d684210c.js"><link rel="prefetch" href="/blog/assets/js/47.853f7f02.js"><link rel="prefetch" href="/blog/assets/js/48.2d0ecdc8.js"><link rel="prefetch" href="/blog/assets/js/49.d7c41614.js"><link rel="prefetch" href="/blog/assets/js/5.a583f437.js"><link rel="prefetch" href="/blog/assets/js/50.f1a6e51d.js"><link rel="prefetch" href="/blog/assets/js/51.29fb5c68.js"><link rel="prefetch" href="/blog/assets/js/52.c183fd4d.js"><link rel="prefetch" href="/blog/assets/js/53.efb504ac.js"><link rel="prefetch" href="/blog/assets/js/54.d8f93ce1.js"><link rel="prefetch" href="/blog/assets/js/55.9b091742.js"><link rel="prefetch" href="/blog/assets/js/56.e8f18e21.js"><link rel="prefetch" href="/blog/assets/js/57.45722d8c.js"><link rel="prefetch" href="/blog/assets/js/58.17cd106d.js"><link rel="prefetch" href="/blog/assets/js/59.b848a093.js"><link rel="prefetch" href="/blog/assets/js/6.d3d9c953.js"><link rel="prefetch" href="/blog/assets/js/60.600fc4af.js"><link rel="prefetch" href="/blog/assets/js/61.698c560e.js"><link rel="prefetch" href="/blog/assets/js/62.24bf6999.js"><link rel="prefetch" href="/blog/assets/js/63.2f87f55d.js"><link rel="prefetch" href="/blog/assets/js/64.68cd3b45.js"><link rel="prefetch" href="/blog/assets/js/65.4f8891d2.js"><link rel="prefetch" href="/blog/assets/js/66.bbb3b98c.js"><link rel="prefetch" href="/blog/assets/js/67.8ca8be23.js"><link rel="prefetch" href="/blog/assets/js/68.014163e7.js"><link rel="prefetch" href="/blog/assets/js/69.0748a26b.js"><link rel="prefetch" href="/blog/assets/js/7.2e5addc9.js"><link rel="prefetch" href="/blog/assets/js/70.f8417ad3.js"><link rel="prefetch" href="/blog/assets/js/71.32fb9ba8.js"><link rel="prefetch" href="/blog/assets/js/72.1b632d10.js"><link rel="prefetch" href="/blog/assets/js/73.ca28169a.js"><link rel="prefetch" href="/blog/assets/js/74.d1755096.js"><link rel="prefetch" href="/blog/assets/js/75.c342eea5.js"><link rel="prefetch" href="/blog/assets/js/76.7a246e05.js"><link rel="prefetch" href="/blog/assets/js/77.e25b5883.js"><link rel="prefetch" href="/blog/assets/js/78.1e612a37.js"><link rel="prefetch" href="/blog/assets/js/79.f11b0022.js"><link rel="prefetch" href="/blog/assets/js/8.cc8f8655.js"><link rel="prefetch" href="/blog/assets/js/80.11223895.js"><link rel="prefetch" href="/blog/assets/js/81.04f50a1e.js"><link rel="prefetch" href="/blog/assets/js/82.db879ca5.js"><link rel="prefetch" href="/blog/assets/js/83.e89b8863.js"><link rel="prefetch" href="/blog/assets/js/84.07410b58.js"><link rel="prefetch" href="/blog/assets/js/85.d46c8682.js"><link rel="prefetch" href="/blog/assets/js/86.52e5e4c9.js"><link rel="prefetch" href="/blog/assets/js/87.e7860b15.js"><link rel="prefetch" href="/blog/assets/js/88.6ed1a43d.js"><link rel="prefetch" href="/blog/assets/js/89.8b302469.js"><link rel="prefetch" href="/blog/assets/js/9.794a82c5.js"><link rel="prefetch" href="/blog/assets/js/90.391f76ed.js"><link rel="prefetch" href="/blog/assets/js/91.b9d1bb73.js"><link rel="prefetch" href="/blog/assets/js/92.a65aa479.js"><link rel="prefetch" href="/blog/assets/js/93.f09d7ba1.js"><link rel="prefetch" href="/blog/assets/js/94.1e2891fe.js"><link rel="prefetch" href="/blog/assets/js/95.6755e920.js"><link rel="prefetch" href="/blog/assets/js/96.7e3abf55.js"><link rel="prefetch" href="/blog/assets/js/97.64d3b035.js"><link rel="prefetch" href="/blog/assets/js/98.fdb7d67a.js"><link rel="prefetch" href="/blog/assets/js/99.b882a726.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b3aba94c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一名GO+PHP工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gitee.com/ColinWWL/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/数据库/Mysql/1视图-触发器-存储过程" class="sidebar-heading clickable open"><span>Mysql</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/数据库/Mysql/1视图-触发器-存储过程.html" class="sidebar-link">视图，存储过程，触发器</a></li><li><a href="/blog/数据库/Mysql/2物化视图-事务.html" class="sidebar-link">物化视图-事务</a></li><li><a href="/blog/数据库/Mysql/3事务日志与锁初体验.html" class="sidebar-link">事务与锁</a></li><li><a href="/blog/数据库/Mysql/4事务隔离与锁的关系.html" class="sidebar-link">事务隔离与锁的关系</a></li><li><a href="/blog/数据库/Mysql/5锁机制与数据库结构.html" class="sidebar-link">锁机制与数据库结构</a></li><li><a href="/blog/数据库/Mysql/6数据库文件.html" class="sidebar-link">数据库结构</a></li><li><a href="/blog/数据库/Mysql/7结构与存储引擎.html" class="active sidebar-link">数据库结构详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/数据库/Mysql/8发现问题.html" class="sidebar-link">问题发现</a></li><li><a href="/blog/数据库/Mysql/9数据库的基础设计.html" class="sidebar-link">数据库基础设计与表设计</a></li><li><a href="/blog/数据库/Mysql/10数据库字段选择与sql执行.html" class="sidebar-link">数据表字段选择与SQL执行流程</a></li><li><a href="/blog/数据库/Mysql/11sql分析.html" class="sidebar-link">sql分析</a></li><li><a href="/blog/数据库/Mysql/12explain实例与IO操作.html" class="sidebar-link">explain实例与IO操作</a></li><li><a href="/blog/数据库/Mysql/13SQL执行IO操作及索引基础.html" class="sidebar-link">SQL执行IO操作及索引基础</a></li><li><a href="/blog/数据库/Mysql/14索引基础.html" class="sidebar-link">索引基础</a></li><li><a href="/blog/数据库/Mysql/15SQL优化实例.html" class="sidebar-link">SQL优化案例实践</a></li><li><a href="/blog/数据库/Mysql/16join初步.html" class="sidebar-link">join 初步</a></li><li><a href="/blog/数据库/Mysql/17join优化思路.html" class="sidebar-link">join优化以及条件解析</a></li><li><a href="/blog/数据库/Mysql/20索引总结iCP与where提取.html" class="sidebar-link">索引总结iCP与where提取</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据库结构详解"><a href="#数据库结构详解" class="header-anchor">#</a> 数据库结构详解</h1> <h3 id="_0-课程内容"><a href="#_0-课程内容" class="header-anchor">#</a> 0. 课程内容</h3> <ol><li>课程回顾</li> <li>MySQL结构</li> <li>MySQL运行流程</li> <li>innodb与myisam比较</li></ol> <h3 id="_1-课程回顾"><a href="#_1-课程回顾" class="header-anchor">#</a> 1. 课程回顾</h3> <ol><li>文件介绍</li> <li>二进制文件</li></ol> <h4 id="_1-1-二进制讲解"><a href="#_1-1-二进制讲解" class="header-anchor">#</a> 1.1 二进制讲解</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 定时情况二进制内容</span>
expire_logs_days<span class="token operator">=</span><span class="token number">7</span>

<span class="token comment">-- 二进制刷新时间</span>
sync_binlog <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>N

<span class="token comment">-- 清空MySQL二进制文件</span>
flush logs<span class="token punctuation">;</span>
reset master<span class="token punctuation">;</span>
</code></pre></div><p>操作：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 设置二进制文件是否开启</span>
<span class="token keyword">SET</span> sql_log_bin<span class="token operator">=</span><span class="token keyword">OFF</span>

<span class="token comment">-- 先创建一个数据库做操作：community</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">`</span>community<span class="token punctuation">`</span> <span class="token punctuation">;</span>

<span class="token keyword">USE</span> community<span class="token punctuation">;</span>

<span class="token comment">-- 添加测试的数据表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>prefix<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token keyword">smallint</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'当天插入记录条数'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>historyCount<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'历史插入记录'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>prefix<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 添加对应的测试数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> count <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'dd1'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> count <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'dd2'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> count <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'dd3'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查看日志文件列表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">BINARY</span> LOGS<span class="token punctuation">;</span>

<span class="token comment">-- 查看日志文件的具体信息</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'mysql-bin.000001'</span><span class="token punctuation">;</span>
</code></pre></div><p>日志文件的中具体信息</p> <p><img src="/blog/assets/img/markdown-img-paste-20190513160116701.632e5105.png" alt=""></p> <p>现在对于数据进行备份操作</p> <p>关于mysqlbinlog的使用参考官网： https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-- 导入到SQL文件中
mysqlbinlog --skip-gtids /usr/local/mysql/data/mysql-bin.000001 <span class="token operator">&gt;</span> /usr/local/mysql/data/community.sql

运行检测内容

<span class="token function">vim</span> /usr/local/mysql/data/community.sql<span class="token punctuation">;</span>

mysql57 -u root -p -e <span class="token string">&quot;source /usr/local/mysql/data/community.sql&quot;</span>
</code></pre></div><p>然后可以做一个比较暴力或者直接的操作；把数据表count删除</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>count<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 或者执行</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>count<span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><p>然后进行数据的还原：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql57 -u root -p -e <span class="token string">&quot;source /usr/local/mysql/data/community.sql&quot;</span>
</code></pre></div><p>关于binlog的写入时间节点：sync_binlog 默认 0</p> <p>sync_binlog=0: 对于日志刷新到磁盘基本上MySQL是不会自己控制刷新，由文件系统自己控制它的缓存刷新。这时候的性能最好，但是风险也是最大的。因为一旦系统出问题在binlog_cache中的所有binlog信息都会被丢失</p> <p>sync_binlog=1: 启用在事务提交之前将二进制日志同步到磁盘。这是最安全的设置，但是由于磁盘写操作的增加，可能会对性能产生负面影响。在发生电源故障或操作系统崩溃时，二进制日志中缺少的事务只处于准备状态。这允许自动恢复例程回滚事务，从而确保二进制日志中没有丢失任何事务。</p> <p>sync_binlog=N：其中N是0或1之外的值:在收集了N个二进制日志提交组之后，将二进制日志同步到磁盘。在发生电源故障或操作系统崩溃时，服务器可能提交了未刷新到二进制日志的事务。由于磁盘写的数量增加，此设置可能对性能产生负面影响。值越大，性能越好，但是数据丢失的风险越大。</p> <h3 id="_3-mysql架构详细讲解"><a href="#_3-mysql架构详细讲解" class="header-anchor">#</a> 3. mysql架构详细讲解</h3> <p>详细版的结构<br> <img src="/blog/assets/img/markdown-img-paste-20190413211639608.c3be54e8.png" alt=""></p> <h5 id="_3-1-运行流程"><a href="#_3-1-运行流程" class="header-anchor">#</a> 3.1 运行流程</h5> <p>MySQL结构图：</p> <p><img src="/blog/assets/img/1111.ff6f296f.png" alt=""></p> <p>执行流程分析：</p> <h6 id="_3-1-1-启动"><a href="#_3-1-1-启动" class="header-anchor">#</a> 3.1.1 启动</h6> <ol><li>通过命令net start mysql(windows) / service mysql start(linux)启动MySQL服务</li> <li>调用初始模块；初始化模块就是在数据库启动的时候，对整个数据库做的一些初始化操作，比如各种系统环境变量的初始化，各种缓存，存储引擎初始化设置等。</li></ol> <p>核心api：MySQL数据库核心api主要实现了数据库底层操作的优化功能，其中主要包括IO操作、格式化输出、高性能存储数据结果算法的优化，字符串的处理，其中最重要的是内存管理。</p> <h6 id="_3-1-2-连接"><a href="#_3-1-2-连接" class="header-anchor">#</a> 3.1.2 连接</h6> <ol start="3"><li>用户发送一条SQL，这个时候会被网络交互模块监听到用户的操作请求，传递给‘连接管理模块’</li> <li>接收到请求转发到‘进/线程连接模块’</li> <li>调用‘用户模块’来进行权限检测（访问数据库的权限）</li> <li>通过检测之后就会去‘连接进/线程模块’从‘线程连接池’中查找空闲的被缓存的连接线程和客户端请求对接，如果失败则创建一个新的连接请求</li> <li>返回连接线程</li></ol> <p>网络交互模块：对外提供可以接收和发送数据的api接口，其他模块需要交互的时候，可以通过api接口调用<br></p> <p>连接管理模块、进/线程连接模块、线程连接池：连接管理模块负责监听MySQL Server的各种请求，根据不同的请求，然后转发到线程管理模块，每个客户请求都会被数据库自动分配一个独立的线程为其单独服务，而连接线程的主要工作就是负责MySQL Server与客户端通信，线程管理模块负责管理这些生成的线程。</p> <h6 id="_3-1-3-处理"><a href="#_3-1-3-处理" class="header-anchor">#</a> 3.1.3 处理</h6> <p><img src="/blog/assets/img/markdown-img-paste-20190418224116819.66fbb396.png" alt=""></p> <ol start="8"><li>在用户权限校验成功之后，并且获得新的连接池之后就会去‘命令分发器’，判断命令的类型如果是select就会去访问‘查询缓存’，如果没有就会往下执行；</li> <li>如果是select，并且开启'查询缓存'之后就会去缓存中查询是否有与之相匹配的SQL,如果有就会校验用户访问该数据的权限,通过就返回不通过就会返回错误信息. 如果数据没有就会往下执行</li> <li>会记录过程中的SQL操作过程到日志文件中</li> <li>在第8,9步 没有满足相应条件之后往下执行进入 '命令解析器',经过词法分析,语法分析后生成解析树</li> <li>根据操作转到对应的模块处理(预处理阶段)，根据SQL选择执行的模块</li> <li>模块收到请求后，通过'访问控制模块'检查所连接的用户是否有访问目标表和目标字段的权限（是指访问这些数据的权限）</li> <li>有权限'表管理模块'先查看table cache中是否存在，有则直接对应的表和获取锁，负责重新打开表文件</li> <li>根据表的ENGINE数据，获取表的存储引擎类型等信息</li> <li>通过接口调用对应的存储引擎处理</li> <li>返回查询之后数据内容</li></ol> <p>用户模块：主要功能是用于控制用户登入连接的权限和用户授权管理。</p> <p>访问控制模块：主要用于监控用户的每一个操作。访问控制模块实现的功能就是根据用户模块中不同的用户授权，以及根据其数据库的各种约束来控制用户对数据的访问。用户模块和访问控制模块结合起来，就组成了MySQL数据库的权限管理功能。</p> <p>查询优化器：这个模块主要是讲客户端发送的查询请求，在之前算法的基础上分析，计算出一个最优的查询策略，优化之后会提高查询访问的速度，最后根据其最优策略返回查询语句。</p> <p>表变更管理模块：主要负责完成DML和DDl的查询，列如，insert，update，delete，create table，alter table等语句处理。</p> <p>表维护模块：主要用于检测表的状态，分析，优化表结构，以及修复表。</p> <p>复制模块：复制模块分为Master模块和Slave模块两部分。Master模块主要负责复制环境中读取Master端的binary日志，以及Slave端的I/O线程交互等工作。</p> <p>状态模块：在客户端请求系统状态的时候，系统状态模块主要负责将各种状态的数据返回给用户。最常用的一些查询状态的命令包括show status，show variable是等，都是通过这个模块负责返回的。</p> <p>表管理模块：主要就是维护系统生成的表文件。列如MyISAM存储引擎就生成frm，myd，myi文件，维护这些文件，江哥哥表结构的信息缓存起来，另外该模块还管理表级别的锁。</p> <p>存储引擎接口模块：MySQL实现了其数据库底层存储引擎的插件师管理，将各种数据处理高度抽象画。</p> <h6 id="_3-1-4-结果"><a href="#_3-1-4-结果" class="header-anchor">#</a> 3.1.4 结果</h6> <ol start="18"><li>命令执行完了之后，将结果集返回给'理解进/线程模块'(返回的也可以是相应标识，成功失败)</li> <li>'理解进/线程模块'进行后续的清理工作，并继续等待请求或断开与客户端的连接</li></ol> <h3 id="_4-存储引擎"><a href="#_4-存储引擎" class="header-anchor">#</a> 4 存储引擎</h3> <p><img src="/blog/assets/img/markdown-img-paste-20190422162407183.0beac3ce.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>-- 查看数据库支持的存储引擎
show engines<span class="token punctuation">;</span>
</code></pre></div><h5 id="_4-1-存储引擎的优点-myisam-innodb"><a href="#_4-1-存储引擎的优点-myisam-innodb" class="header-anchor">#</a> 4.1 存储引擎的优点(myisam, innodb)</h5> <h6 id="_4-1-1-myisam"><a href="#_4-1-1-myisam" class="header-anchor">#</a> 4.1.1 myisam</h6> <p>MyISAM 在磁盘上攒簇三个文件，文件名和对应的表名是一致的</p> <ul><li>frm文件：存储表的定义数据。</li> <li>myd文件：存放表具体记录数据。</li> <li>myi文件：存储索引。</li></ul> <p>MyISAM存储引擎不支持事务，也不支持主键，对数据的存储和批量查询的速度比较快。</p> <p>在实际应用中，往往对于不需要完整的事务，主要以查询和增加记录为主的应用采用myisam存储引擎（日志）</p> <h6 id="_4-1-2-innodb"><a href="#_4-1-2-innodb" class="header-anchor">#</a> 4.1.2 innodb</h6> <p>innodb是第三方公司开发的，目前应用最广泛的数据存储引擎除了满意三之外就是innodb了，innodb写的处理相对于myisam效率低一些，innodb牺牲了存储和查询的效率，支持事务安全，支持自动增长列，对于输完液安全的支持，这是innodb成为myisam最为流行的存储器引擎之一的重要原因。</p> <p>外键约束</p> <p>innodb实现了外键这一数据库重要功能，从数据库性能上讲数据库外键降低了数据库查询的效率，数据库表之间的耦合度更加紧密，但是对于不少用户来讲，采用外键约束可能是低成本的选择方式</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/21/2021, 1:25:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/数据库/Mysql/6数据库文件.html" class="prev">
        数据库结构
      </a></span> <span class="next"><a href="/blog/数据库/Mysql/8发现问题.html">
        问题发现
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.92f490ec.js" defer></script><script src="/blog/assets/js/3.21e2e031.js" defer></script><script src="/blog/assets/js/39.3191561f.js" defer></script>
  </body>
</html>
