(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{1275:function(e,a,s){"use strict";s.r(a);var n=s(19),t=Object(n.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"核心技术-secret"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心技术-secret"}},[e._v("#")]),e._v(" 核心技术-Secret")]),e._v(" "),s("h2",{attrs:{id:"secret-存在意义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret-存在意义"}},[e._v("#")]),e._v(" Secret 存在意义")]),e._v(" "),s("p",[e._v("Secret 解决了密码、token、密钥等敏感数据的配置问题，而不需要把这些敏感数据暴露到镜像或者 Pod Spec 中。Secret 可以以 Volume 或者环境变量的方式使用")]),e._v(" "),s("h2",{attrs:{id:"secret-有三种类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret-有三种类型"}},[e._v("#")]),e._v(" Secret 有三种类型")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Service Account : 用来访问 Kubernetes API, 由 Kubernetes 自动创建，并且会自动挂载到 Pod 的 /run/secrets/kubernetes.io/serviceaccount 目录中")])]),e._v(" "),s("li",[s("p",[e._v("Opaque : base64 编码格式的 Secret, 用来存储密码、密钥等")])]),e._v(" "),s("li",[s("p",[e._v("kubernetes.io/dockerconfigjson （可能会废弃）：用来存储私有 docker registry 的认证信息")])])]),e._v(" "),s("h2",{attrs:{id:"service-account"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-account"}},[e._v("#")]),e._v(" Service Account")]),e._v(" "),s("p",[e._v("Service Account 用来访问 Kubernetes API, 甶 Kubernetes 自动创建，并且会自动挂载到 Pod 的/run/secrets/kubernetes.io/serviceaccount 目录中")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl run nginx --image nginx\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl get pods\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" nginx-3137573019-md1u2 "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\n")])])]),s("h2",{attrs:{id:"opaque-secret"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opaque-secret"}},[e._v("#")]),e._v(" Opaque Secret")]),e._v(" "),s("h3",{attrs:{id:"创建说明-opaque-类型的数据是一个-map-类型-要求-value-是-base64-编码格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建说明-opaque-类型的数据是一个-map-类型-要求-value-是-base64-编码格式"}},[e._v("#")]),e._v(" 创建说明：Opaque 类型的数据是一个 map 类型，要求 value 是 base64 编码格式")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" -n "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"admin"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("YWRtaW4")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" -n "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"1f2d1e2e67df"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64\n\nMWYyZDFlMmU2N2Rm:\n")])])]),s("h3",{attrs:{id:"secrets-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secrets-yml"}},[e._v("#")]),e._v(" secrets.yml")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("apiVersion: v1\n\nkind: Secret\n\nmetadata:\n\nname: mysecret\n\ntype: Opaque\n\ndata:\n\npassword: MWYyZDFlMmU2N2Rm\n\nusername: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("YWRtaW4")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n\n")])])]),s("h3",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[e._v("#")]),e._v(" 使用方式")]),e._v(" "),s("p",[e._v("将 Secret 挂载到 Volume 中")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v('apiVersion: v1\n\nkind: Pod\n\nmetadata:\n\nlabels:\n\nname: seret-test\n\nname: seret-test\n\nspec:\n\nvolumes:\n\n - name: secrets\n\nsecret:\n\nsecretName: mysecret\n\ncontainers:\n\n-image: hub.atguigu.com/library/myapp:v1\n\nname: db\n\nvolumeMounts:\n\n - name: secrets\n\nmountPath:"\n\nreadOnly: '),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n\n将 Secret 导出到环境变量中\n\napiVersion: extensions/v1beta1\n\nkind: Deployment\n\nmetadata:\n\nname: pod-deployment\n\nspec:\n\nreplicas: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n\ntemplate:\n\nmetadata:\n\nlabels:\n\napp: pod-deployment\n\nspec:\n\ncontainers:\n\n - name: pod-1\n\nimage: hub.atguigu.com/library/myapp:v1\n\nports:\n\n-containerPort: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("\n\nenv:\n\n-name: TEST_USER\n\nvalueFrom:\n\nsecretKeyRef:\n\nname: mysecret\n\nkey: username\n\n")])])])])}),[],!1,null,null,null);a.default=t.exports}}]);